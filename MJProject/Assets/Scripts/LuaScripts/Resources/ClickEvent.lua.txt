local gbk = require "gbk"
local Effect = require "Effect"
local StringTable = require "StringTable"
ClickEvent = {}
ClickEvent.panelTable = {
	_main_ui = "Login",
	_choose_ui = "MainMenu",
	_create_room_ui = "CreateRoom",
	_join_room_ui = "GetintoRoom",
	_other_message_ui = "OtherMessageUI",
	_player_message_ui = "PlayerMessageUI",
	_mall_ui = "Mall",
	_mail_ui = "Mail",
	_setting_ui = "Setting",
	_vip_note_ui = "VIPNote",
	_history_score_ui = "HistoryScene",
	_store_ui = "StoreUI",
	_play_game_ui = "PlaySence",
	_player_info = "PlayerInfo",
	_other_player_info = "OtherPlayerInfo",
	_calculate_ui = "ClearRoundScene",
	_window_big = "PopWindowsBig",
	_window_mid = "PopWindowsMid",
	_window_small = "PopWindowsSmall",
	_exit_game_ui = "ExitGamePop",
	_instruction_ui = "HowToPlay",
	_welfare_ui = "WelfareScene",
	_activity_ui = "Activity",
	_toast_ui = "Toast",
	_not_move_toast_ui = "NotMoveToast",
	_room_calculate_ui = "FinishBalance",
	_vote_ui = "Vote",
	_share_calculate_ui = "Share"
}
ClickEvent.uiPanel = nil
ClickEvent.isInDouRoom = false
ClickEvent.scale = nil

ClickEvent._createObject = {}
ClickEvent._play_ui = {}

local _position_index = {
	POSITION_TYPE_EAST = 1,
	POSITION_TYPE_SOUTH = 2,
	POSITION_TYPE_WEST = 3,
	POSITION_TYPE_NORTH = 4,
}

local operationState = Enum.CreateEnumTable({"WAIT", "PENG", "GANG", "CHI", "HU", "DAPAI", "XUANFENGGANGFENG", "XUANFENGGANGJIAN", "ANGANG", "TINGPAI", "BAOPAI"},-1)

local notPushPassMsg = false

local _currentPanel = {}
local _popPanel = {}
local popPanelIndex = 0
local popBgIndex = 0
local Camera = CS.UnityEngine.Camera
local LogWarning = CS.UnityEngine.Debug.LogWarning
local WeChatPlatform = CS.Platform.Instance

local util = require "xlua.util"
local function AsyncYieldReturn(to_yield, cb)
    ClickEvent.self:YieldAndCallback(to_yield, cb)
end
local yield_return = util.async_to_sync(AsyncYieldReturn)

function ClickEvent.Awake( ... )
	-- body
	UIPackage.AddPackage("FairyUI/MXUI")
	UIConfig.defaultFont = "MJFont"
	ClickEvent.uiPanel = CS.UnityEngine.GameObject.Find("UIPanel"):GetComponent("UIPanel")
	ClickEvent.scale = ClickEvent.uiPanel.transform.localScale.x
	ClickEvent._createObject = {}
	CS.UnityEngine.Application.targetFrameRate = 30
end
function ClickEvent.Start(loadUI)
	-- body
	ClickEvent.uiPanel.ui.visible = false
	GRoot.inst:RemoveChildren()
	ClickEvent.CreateNewPanel(loadUI)
	if ClickEvent.uiPanel.ui.visible then
	end
	_popPanel = {}
	popBgIndex = 0
	popPanelIndex = 0
end

function ClickEvent.WeChatGetMessage()
    -- body
    local code = WeChatPlatform:GetData("getWXCode")
    --[[
    local token = WeChatPlatform:GetData("getToken")
    if code and code ~= "" then
        WeChatPlatform:GetWeChatMethod("getAccess_token")
        return
    else
    	return
    end
    --]]
end

function ClickEvent.DeletePanel(deletePanel)
	-- body
	GRoot.inst:RemoveChild(deletePanel)
end

function ClickEvent.CreateNewPanel(panelName)
	-- body
	if panelName == ClickEvent.panelTable._main_ui then
		if Player and Player._tosence_name then
			if Player._tosence_name == "LoadingSence" or Player._tosence_name == "PlaySence" then
				return
			end
		end
	end
	if not ClickEvent._createObject[panelName] then
		ClickEvent._createObject[panelName] = UIPackage.CreateObject("MXUI", panelName)
	end
	_currentPanel.panel = ClickEvent._createObject[panelName]
	_currentPanel.panel.name = panelName
	_currentPanel.panel:SetSize(GRoot.inst.width, GRoot.inst.height)
	_currentPanel.panel:SetPosition(0,0,0)
	GRoot.inst:AddChild(_currentPanel.panel)
	local childNumber = _currentPanel.panel.numChildren
	for i=0,childNumber-1 do
		local obj = _currentPanel.panel:GetChildAt(i)
		if obj.group and obj.group.name == "Btns" then
			obj.onClick:Add(ClickEvent.registerButtonClick)
		end
	end
	--[[
	if Player._player_data and Player._player_data.common_prop and _currentPanel.panel:GetChild("Name") and _currentPanel.panel:GetChild("Name"):GetChild("PlayerName") then
		CS.UnityEngine.Debug.Player.LogWarning(Player._player_data.common_prop.name)
		_currentPanel.panel:GetChild("Name"):GetChild("PlayerName").text = Player._player_data.common_prop.name
	end
	--]]
	if not ClickEvent._play_ui then
		ClickEvent._play_ui = {}
	end

	if panelName == ClickEvent.panelTable._play_game_ui then
		ClickEvent._play_ui.chiPaiBar = _currentPanel.panel:GetChild("ChiPaiBg")
		ClickEvent._play_ui.chiPaiBar.visible = false
		ClickEvent._play_ui.gangPaiBar = _currentPanel.panel:GetChild("GangPaiBg")
		ClickEvent._play_ui.gangPaiBar.visible = false
		ClickEvent._play_ui.huPaiBar = _currentPanel.panel:GetChild("HuPaiBg")
		ClickEvent._play_ui.huPaiBar.visible = false
		ClickEvent._play_ui.operationBar = _currentPanel.panel:GetChild("GameOperationBar")
		ClickEvent._play_ui.passButton = _currentPanel.panel:GetChild("GamePassButton")
		ClickEvent._play_ui.passButton.visible = false
		ClickEvent._play_ui.cancelButton = _currentPanel.panel:GetChild("GameCancelButton")
		ClickEvent._play_ui.cancelButton.visible = false
		ClickEvent._play_ui.oppositePlayerTing = _currentPanel.panel:GetChild("OppositePlayerTing")
		ClickEvent._play_ui.frontPlayerTing = _currentPanel.panel:GetChild("FrontPlayerTing")
		ClickEvent._play_ui.behindPlayerTing = _currentPanel.panel:GetChild("BehindPlayerTing")
		ClickEvent._play_ui.playerTing = _currentPanel.panel:GetChild("PlayerTing")
		ClickEvent._play_ui.oppositePlayerTing.visible = false
		ClickEvent._play_ui.frontPlayerTing.visible = false
		ClickEvent._play_ui.behindPlayerTing.visible = false
		ClickEvent._play_ui.playerTing.visible = false
		ClickEvent._play_ui.gamePlayButton = _currentPanel.panel:GetChild("GamePlayButton")
		ClickEvent._play_ui.gamePlayButton.visible = false
		ClickEvent._play_ui.hintBar = _currentPanel.panel:GetChild("GameHintBar")
		ClickEvent._play_ui.hintBar.visible = false
		ClickEvent._play_ui.uselessRound = _currentPanel.panel:GetChild("Draw")
		ClickEvent._play_ui.uselessRound.visible = false
		ClickEvent._play_ui.frontPaiShow = _currentPanel.panel:GetChild("FrontPaiShow")
		ClickEvent._play_ui.frontPaiShow.visible = false
		ClickEvent._play_ui.behindPaiShow = _currentPanel.panel:GetChild("BehindPaiShow")
		ClickEvent._play_ui.behindPaiShow.visible = false
		ClickEvent._play_ui.oppositePaiShow = _currentPanel.panel:GetChild("OppositePaiShow")
		ClickEvent._play_ui.oppositePaiShow.visible = false
		ClickEvent._play_ui.playerAvatarInfo = _currentPanel.panel:GetChild("PlayerAvatarInfo")
		ClickEvent._play_ui.behindPlayerAvatarInfo = _currentPanel.panel:GetChild("BehindPlayerAvatarInfo")
		ClickEvent._play_ui.oppositePlayerAvatarInfo = _currentPanel.panel:GetChild("OppositePlayerAvatarInfo")
		ClickEvent._play_ui.frontPlayerAvatarInfo = _currentPanel.panel:GetChild("FrontPlayerAvatarInfo")
		ClickEvent._play_ui.selfBanker = ClickEvent._play_ui.playerAvatarInfo:GetChild("Zhuang")
		ClickEvent._play_ui.nextBanker = ClickEvent._play_ui.behindPlayerAvatarInfo:GetChild("Zhuang")
		ClickEvent._play_ui.oppositeBanker = ClickEvent._play_ui.oppositePlayerAvatarInfo:GetChild("Zhuang")
		ClickEvent._play_ui.forwardBanker = ClickEvent._play_ui.frontPlayerAvatarInfo:GetChild("Zhuang")
		ClickEvent._play_ui.selfBanker.visible = false
		ClickEvent._play_ui.nextBanker.visible = false
		ClickEvent._play_ui.oppositeBanker.visible = false
		ClickEvent._play_ui.forwardBanker.visible = false
		ClickEvent._play_ui.remainNum = _currentPanel.panel:GetChild("RemainNum")
		ClickEvent._play_ui.remainNum.text = "136"
		ClickEvent._play_ui.frontAlready = _currentPanel.panel:GetChild("FrontAlready")
		ClickEvent._play_ui.oppositeAlready = _currentPanel.panel:GetChild("OppositeAlready")
		ClickEvent._play_ui.behindAlready = _currentPanel.panel:GetChild("BehindAlready")
		ClickEvent._play_ui.playerAlready = _currentPanel.panel:GetChild("PlayerAlready")
		ClickEvent._play_ui.frontAlready.visible = false
		ClickEvent._play_ui.oppositeAlready.visible = false
		ClickEvent._play_ui.behindAlready.visible = false
		ClickEvent._play_ui.playerAlready.visible = false
		ClickEvent._play_ui.inviteWechatFriends = _currentPanel.panel:GetChild("InviteWechatFriends")
		--ClickEvent._play_ui.inviteWechatFriends.visible = false
		ClickEvent._play_ui.copyRoomNum = _currentPanel.panel:GetChild("CopyRoomNum")
		ClickEvent._play_ui.timeShow = _currentPanel.panel:GetChild("Wlan"):GetChild("Time")
		--ClickEvent._play_ui.copyRoomNum.visible = false
		_currentPanel.panel:GetChild("RoundNumber"):GetChild("CurrentRoundNum").text = "0"
		_currentPanel.panel:GetChild("RoundNumber"):GetChild("TotalRoundNum").text = tostring(Player._room_information.options.open_rands)
		_currentPanel.panel:GetChild("GameListenButton").selected = true
		_currentPanel.panel:GetChild("GameVoiceButton").selected = true

		Player.MahJong.UpdateRoomNumber(tostring(Player._roomId))

		ClickEvent._play_ui.baopaiLoader = _currentPanel.panel:GetChild("BaoPai"):GetChild("PaiSingle"):GetChild("BaoPaiLoader")
		_currentPanel.panel:GetChild("BaoPai"):GetController("BaoPaiShow").selectedIndex = 0
		local hasBaoPai = false
		for k,v in pairs(Player._room_information.options.extend_type) do
			if v == "ROOM_EXTEND_TYPE_BAOPAI" then
				hasBaoPai = true
			end
		end
		if hasBaoPai == true then
			_currentPanel.panel:GetChild("BaoPai").visible = true
		else
			_currentPanel.panel:GetChild("BaoPai").visible = false
		end
		------特效
		ClickEvent._play_ui.playerAvatarInfoEffect = Effect.AddUIEffect(Effect._effect_name.head_ui,CS.UnityEngine.Vector3(110,110,110),ClickEvent._play_ui.playerAvatarInfo)
		ClickEvent._play_ui.behindPlayerAvatarInfoEffect = Effect.AddUIEffect(Effect._effect_name.head_ui,CS.UnityEngine.Vector3(110,110,110),ClickEvent._play_ui.behindPlayerAvatarInfo)
		ClickEvent._play_ui.oppositePlayerAvatarInfoEffect = Effect.AddUIEffect(Effect._effect_name.head_ui,CS.UnityEngine.Vector3(110,110,110),ClickEvent._play_ui.oppositePlayerAvatarInfo)
		ClickEvent._play_ui.frontPlayerAvatarInfoEffect = Effect.AddUIEffect(Effect._effect_name.head_ui,CS.UnityEngine.Vector3(110,110,110),ClickEvent._play_ui.frontPlayerAvatarInfo)
		ClickEvent._play_ui.playerAvatarInfoEffect.visible = false
		ClickEvent._play_ui.behindPlayerAvatarInfoEffect.visible = false
		ClickEvent._play_ui.oppositePlayerAvatarInfoEffect.visible = false
		ClickEvent._play_ui.frontPlayerAvatarInfoEffect.visible = false
		---------------
		ClickEvent._play_ui.playerAvatarInfo.visible = false
		ClickEvent._play_ui.behindPlayerAvatarInfo.visible = false
		ClickEvent._play_ui.oppositePlayerAvatarInfo.visible = false
		ClickEvent._play_ui.frontPlayerAvatarInfo.visible = false

		ClickEvent._play_ui.titleFather = _currentPanel.panel:GetChild("Inform")
		ClickEvent._play_ui.moveTitleText = _currentPanel.panel:GetChild("Inform"):GetChild("InformText"):GetChild("txtMove")
		ClickEvent._play_ui.moveTitle = _currentPanel.panel:GetChild("Inform"):GetChild("InformText"):GetTransition("Txt")
		ClickEvent._play_ui.titleFather.visible = false
		ClickEvent._play_ui.gameMoreControl = _currentPanel.panel:GetController("Menu")

		local emojiList = _currentPanel.panel:GetChild("Emoji"):GetChild("HelloEmojiList")--.onClickItem:Add(ClickEvent.registerButtonClick)
		for i=0,emojiList.numChildren-1 do
			local obj = emojiList:GetChildAt(i)
			obj.onClick:Add(ClickEvent.registerButtonClick)
		end
		emojiList = _currentPanel.panel:GetChild("Emoji"):GetChild("HelloTextList")--.onClickItem:Add(ClickEvent.registerButtonClick)
		for i=0,emojiList.numChildren-1 do
			local obj = emojiList:GetChildAt(i)
			obj.onClick:Add(ClickEvent.registerButtonClick)
		end

		ClickEvent._play_ui.playerEmoji = _currentPanel.panel:GetChild("PlayerEmojiShow")
		ClickEvent._play_ui.behindEmoji = _currentPanel.panel:GetChild("BehindEmojiShow")
		ClickEvent._play_ui.oppositeEmoji = _currentPanel.panel:GetChild("OppositeEmojiShow")
		ClickEvent._play_ui.FrontEmoji = _currentPanel.panel:GetChild("FrontEmojiShow")

		if Player.isFriendRoom == true then
			_currentPanel.panel:GetChild("GameTrusteeshipButton").visible = false
		end
		--[[
		effectPlayer.transform.position = Camera.main:ScreenToWorldPoint(ClickEvent._play_ui.playerAvatarInfo:TransformPoint(ClickEvent._play_ui.playerAvatarInfo.xy,nil).x,
			ClickEvent._play_ui.playerAvatarInfo:TransformPoint(ClickEvent._play_ui.playerAvatarInfo.xy,nil).y,0.35)
		ClickEvent._play_ui.playerAvatarInfo:AddChild(x)
		--]]
	elseif panelName == ClickEvent.panelTable._choose_ui and Player._player_data then
		if Player.wechat_nickname and Player.wechat_nickname ~= "" then
			_currentPanel.panel:GetChild("Name"):GetChild("PlayerName").text = tostring(gbk.toutf8(gbk.fromutf8(Player.wechat_nickname)))
		else
			_currentPanel.panel:GetChild("Name"):GetChild("PlayerName").text = tostring(Player._player_data.common_prop.name)
		end
		_currentPanel.panel:GetChild("DouNum"):GetChild("DouNum").text = tostring(Player._player_data.common_prop.huanledou)
		_currentPanel.panel:GetChild("GemsNum"):GetChild("GemsNum").text = tostring(Player._player_data.common_prop.diamond)
		_currentPanel.panel:GetChild("RoomCardNum"):GetChild("RoomCardNum").text = tostring(Player._player_data.common_prop.room_card_count)
		ClickEvent._play_ui.waitingPop = _currentPanel.panel:GetChild("WaitingPop")
		ClickEvent._play_ui.waitingPop:GetChild("CloseWaiting").onClick:Add(ClickEvent.registerButtonClick)
		ClickEvent._play_ui.waitingPopTime = ClickEvent._play_ui.waitingPop:GetChild("MatchTimer")

		ClickEvent._play_ui.avatarLoader = _currentPanel.panel:GetChild("Avatar"):GetChild("AvatarLoader")
		--_currentPanel.panel:GetChild("Inform"):GetChild("InformText"):GetChild("txtFixed").text = "[Color=#70DB93,#B5A642]游戏严打外挂，一旦发现立即封号[/Color]"
		ClickEvent._play_ui.titleFather = _currentPanel.panel:GetChild("Inform")
		ClickEvent._play_ui.moveTitleText = _currentPanel.panel:GetChild("Inform"):GetChild("InformText"):GetChild("txtMove")
		ClickEvent._play_ui.moveTitle = _currentPanel.panel:GetChild("Inform"):GetChild("InformText"):GetTransition("Txt")
		ClickEvent._play_ui.titleFather.visible = false
		if Player.wechat_headimgurl and Player.wechat_headimgurl ~= "" then
			ClickEvent._play_ui.avatarLoader.url = ""
			WeChatPlatform.func = nil
			local tempTexture = WeChatPlatform:SetAsyncImage(Player.wechat_headimgurl)
			WeChatPlatform:SetFuncDelegate(function ()
				-- body
				local delegateTex = WeChatPlatform:SetAsyncImage(Player.wechat_headimgurl)
				if delegateTex then
					ClickEvent._play_ui.avatarLoader.texture = NTexture(delegateTex)
				end
				WeChatPlatform.func = nil
			end)
			--[[
			--]]
			if tempTexture then
				ClickEvent._play_ui.avatarLoader.texture = NTexture(tempTexture)
			end
		end
		local x = 1/ClickEvent.scale
		Effect.AddUIEffect(Effect._effect_name.gold_ui,CS.UnityEngine.Vector3(x,x,x),_currentPanel.panel:GetChild("DouNum"),_currentPanel.panel:GetChild("DouNum"):GetChild("n7").xy+_currentPanel.panel:GetChild("DouNum"):GetChild("n7").size/2)
		Effect.AddUIEffect(Effect._effect_name.gem_ui,CS.UnityEngine.Vector3(x,x,x),_currentPanel.panel:GetChild("GemsNum"),_currentPanel.panel:GetChild("GemsNum"):GetChild("n7").xy+_currentPanel.panel:GetChild("GemsNum"):GetChild("n7").size/2)
		Effect.AddUIEffect(Effect._effect_name.shangcheng_ui,CS.UnityEngine.Vector3(x,x,x),_currentPanel.panel:GetChild("Shop"),CS.UnityEngine.Vector2(_currentPanel.panel:GetChild("Shop").width*0.7,_currentPanel.panel:GetChild("Shop").height*0.52))

		if Player._player_data.room_id and Player._player_data.room_id ~= 0 then
			ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
			_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(2036)
		end
		--[[
		local image = _currentPanel.panel:GetChild("Back"):GetChild("n1")
		Player.LogWarning(image.displayObject.gameObject:GetComponent("Renderer").bounds.size.x)
		Player.LogWarning(image.displayObject.size.x * ClickEvent.scale)
		for k,v in pairs(Player._player_data.inventory.inventory) do
			for j,c in pairs(v.items) do
				Player.LogWarning("ITEM_TYPE_ROOM_CARD")
				Player.LogWarning(c.type_t)
				if c.type_t == "ITEM_TYPE_ROOM_CARD" then
					local tempMsg = protobuf.decode(AssetManager.GetMessagesByType(c.type_t),c.stuff)
					_currentPanel.panel:GetChild("RoomCardNum"):GetChild("RoomCardNum").text = tostring(tempMsg.item_common_prop.count)
				end
			end
		end
		--]]
		elseif panelName == ClickEvent.panelTable._main_ui then
			if CS.LuaCommon.isAndroid or CS.LuaCommon.isIos then
				_currentPanel.panel:GetChild("Title").visible = false
				_currentPanel.panel:GetChild("Account").visible = false
				_currentPanel.panel:GetChild("LoginButton").visible = false
			end
			local x = 1/ClickEvent.scale
			Effect.AddUIEffect(Effect._effect_name.mainUI,CS.UnityEngine.Vector3(100,100,100),_currentPanel.panel,_currentPanel.panel:GetChild("n20").xy+CS.UnityEngine.Vector2(_currentPanel.panel:GetChild("n20").width*0.48,_currentPanel.panel:GetChild("n20").height*0.5))
	end
	
	--[[
	ClickEvent._play_ui.roomId = _currentPanel.panel:GetChild("RoomID")
	if ClickEvent._play_ui.roomId then
		--ClickEvent._play_ui.roomId.text = tostring(Player._roomId)
		ClickEvent._play_ui.roomId.visible = false
	end
	--]]
end

function ClickEvent.CommonPropertyUpdate( ... )
	-- body
	if _currentPanel.panel.name == ClickEvent.panelTable._choose_ui then
		--_currentPanel.panel:GetChild("Name"):GetChild("PlayerName").text = Player._player_data.common_prop.name
		_currentPanel.panel:GetChild("DouNum"):GetChild("DouNum").text = tostring(Player._player_data.common_prop.huanledou)
		_currentPanel.panel:GetChild("GemsNum"):GetChild("GemsNum").text = tostring(Player._player_data.common_prop.diamond)
		_currentPanel.panel:GetChild("RoomCardNum"):GetChild("RoomCardNum").text = tostring(Player._player_data.common_prop.room_card_count)
	end
end

function ClickEvent.CreateOperationButton( ... )
	-- body
	_currentPanel.buttonList = {}
	_currentPanel.buttonList["GameChiButton"] = UIPackage.GetItemURL("MXUI","GameChiButton")
	_currentPanel.buttonList["GamePengButton"] = UIPackage.GetItemURL("MXUI","GamePengButton")
	_currentPanel.buttonList["GameGangButton"] = UIPackage.GetItemURL("MXUI","GameGangButton")
	_currentPanel.buttonList["GameHuButton"] = UIPackage.GetItemURL("MXUI","GameHuButton")
	_currentPanel.buttonList["GameTingButton"] = UIPackage.GetItemURL("MXUI","GameTingButton")
	_currentPanel.buttonList["XuanFengButton"] = UIPackage.GetItemURL("MXUI","XuanFengButton")
	_currentPanel.buttonList["ClearShowFan"] = UIPackage.GetItemURL("MXUI","ClearShowFan")
end

function ClickEvent.ShowSmallWindow(showContentNumber)
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(showContentNumber)
end

function ClickEvent.ShowAlready(playerID)
	-- body
	local currentPositionData
	for j,m in pairs(Player._all_players_data) do
		if playerID == m.common_prop.player_id then
			currentPositionData = m
			break
		end
	end
	local tempX = _position_index[currentPositionData.position] - _position_index[Player._my_player_data.position]
	if tempX == 1 then
		ClickEvent._play_ui.behindAlready.visible = true
	elseif tempX == 2 then
		ClickEvent._play_ui.oppositeAlready.visible = true
	elseif tempX == 3 then
		ClickEvent._play_ui.frontAlready.visible = true
	else
		ClickEvent._play_ui.playerAlready.visible = true
	end
end

function ClickEvent.ShowBaoPai(paiData)
	-- body
	_currentPanel.panel:GetChild("BaoPai"):GetController("BaoPaiShow").selectedIndex = 1
	ClickEvent._play_ui.baopaiLoader.url = UIPackage.GetItemURL("MXUI",paiData.card_type.."_"..paiData.card_value)
 end

function ClickEvent.UpdateTime( ... )
	-- body
	if _currentPanel and _currentPanel.panel and _currentPanel.panel.name == ClickEvent.panelTable._play_game_ui then
		local hour = tostring(CS.System.DateTime.Now.Hour)
		local minute = tostring(CS.System.DateTime.Now.Minute)
		if CS.System.DateTime.Now.Hour < 10 then
			hour = "0"..tostring(CS.System.DateTime.Now.Hour)
		end
		if CS.System.DateTime.Now.Minute < 10 then
			minute = "0"..tostring(CS.System.DateTime.Now.Minute)
		end
		ClickEvent._play_ui.timeShow.text = hour..":"..minute
	end
end

function ClickEvent.PlayMoveTitle()
	-- body
	if CS.UnityEngine.Application.loadedLevelName ~= "PlaySence" and CS.UnityEngine.Application.loadedLevelName ~= "FairyMainUI" then
		return
	end
	if not _currentPanel or not _currentPanel.panel or not ClickEvent._play_ui.titleFather then
		return
	end
	if _currentPanel.panel.name ~= ClickEvent.panelTable._choose_ui and _currentPanel.panel.name ~= ClickEvent.panelTable._play_game_ui then
		return
	end
	ClickEvent._play_ui.titleFather.visible = true
	if ClickEvent._play_ui.moveTitleText.text == StringTable.Get(2050) then
		ClickEvent._play_ui.moveTitleText.text = StringTable.Get(2051)
	elseif ClickEvent._play_ui.moveTitleText.text == StringTable.Get(2051) then
		ClickEvent._play_ui.moveTitleText.text = StringTable.Get(2052)
	elseif ClickEvent._play_ui.moveTitleText.text == StringTable.Get(2052) then
		ClickEvent._play_ui.moveTitleText.text = StringTable.Get(2050)
	else
		ClickEvent._play_ui.moveTitleText.text = StringTable.Get(2050)
	end
	ClickEvent._play_ui.moveTitle:SetValue("Time",-ClickEvent._play_ui.moveTitleText.width,16)
	ClickEvent._play_ui.moveTitle:SetHook("Time",function()
		-- body
		ClickEvent._play_ui.titleFather.visible = false
	end)
	ClickEvent._play_ui.moveTitle:Play()
end

function ClickEvent.UpdateRoundNumber(CurrentRoundNum,TotalRoundNum)
	-- body
	_currentPanel.panel:GetChild("RoundNumber"):GetChild("CurrentRoundNum").text = tostring(CurrentRoundNum)
	_currentPanel.panel:GetChild("RoundNumber"):GetChild("TotalRoundNum").text = tostring(TotalRoundNum)
end

function ClickEvent.CloseAlready( ... )
	-- body
	ClickEvent._play_ui.frontAlready.visible = false
	ClickEvent._play_ui.oppositeAlready.visible = false
	ClickEvent._play_ui.behindAlready.visible = false
	ClickEvent._play_ui.playerAlready.visible = false
end

function ClickEvent.AddOperationButton( buttonName )
	-- body
	local operationButtonTemp = ClickEvent._play_ui.operationBar:AddItemFromPool(_currentPanel.buttonList[buttonName])
	operationButtonTemp.name = buttonName
	operationButtonTemp.onClick:Add(ClickEvent.registerButtonClick)
end

function ClickEvent.PlayerPosition(position)
	-- body
	if Player._my_player_data.position then
		local tempX = _position_index[position] - _position_index[Player._my_player_data.position]
		return tempX
	end
	return nil
end

function ClickEvent.SetRemainNum( paiRemainNum )
 	-- body
 	ClickEvent._play_ui.remainNum.text = tostring(paiRemainNum)
 end 

function ClickEvent.RoomInformationUpdate( ... )
	-- body
	Player.LogWarning(Player._my_player_data.position)
	local x = _position_index[Player._my_player_data.position]
	for k,v in pairs(_position_index) do
		if v >= x then
			_position_index[k] = v - x + 1
		else
			_position_index[k] = 5 + v - x
		end
	end
	for k,v in pairs(_position_index) do
		Player.LogWarning(k)
		Player.LogWarning(v)
	end
	ClickEvent._play_ui.behindPlayerAvatarInfo.visible = false
	ClickEvent._play_ui.oppositePlayerAvatarInfo.visible = false
	ClickEvent._play_ui.frontPlayerAvatarInfo.visible = false
	WeChatPlatform.func = nil
	WeChatPlatform:SetFuncDelegate(ClickEvent.UpdatePlayersHeadImg)
	local countPlayerNumber = 0
	for k,v in pairs(Player._all_players_data) do
		countPlayerNumber = countPlayerNumber + 1
		local tempX = _position_index[v.position] - _position_index[Player._my_player_data.position]
		if tempX == 1 then
			ClickEvent._play_ui.behindPlayerAvatarInfo.visible = true
			if v.position == "POSITION_TYPE_EAST" then
				ClickEvent._play_ui.behindPlayerAvatarInfo:GetChild("RoomLord").visible = true
			else
				ClickEvent._play_ui.behindPlayerAvatarInfo:GetChild("RoomLord").visible = false
			end
			ClickEvent._play_ui.behindPlayerAvatarInfo:GetChild("PlayerLineState").visible = false
			if v.wechat and v.wechat.nickname and v.wechat.nickname ~= "" then
				ClickEvent._play_ui.behindPlayerAvatarInfo:GetChild("PlayerName").text = tostring(gbk.toutf8(gbk.fromutf8(v.wechat.nickname)))
			else
				ClickEvent._play_ui.behindPlayerAvatarInfo:GetChild("PlayerName").text = tostring(v.common_prop.name)
			end
			ClickEvent._play_ui.behindPlayerAvatarInfo:GetChild("DouNum").text = tostring(Player.playerScore[tempX])
			ClickEvent._play_ui.behindPlayerAvatarInfo:GetChild("AvatarLoader").url = UIPackage.GetItemURL("MXUI","Touxiang01")
			if v.wechat and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
				ClickEvent._play_ui.behindPlayerAvatarInfo:GetChild("AvatarLoader").url = ""
				local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
				if tempTexture then
					ClickEvent._play_ui.behindPlayerAvatarInfo:GetChild("AvatarLoader").texture = NTexture(tempTexture)
				end
			end
		elseif tempX == 2 then
			ClickEvent._play_ui.oppositePlayerAvatarInfo.visible = true
			if v.position == "POSITION_TYPE_EAST" then
				ClickEvent._play_ui.oppositePlayerAvatarInfo:GetChild("RoomLord").visible = true
			else
				ClickEvent._play_ui.oppositePlayerAvatarInfo:GetChild("RoomLord").visible = false
			end
			ClickEvent._play_ui.oppositePlayerAvatarInfo:GetChild("PlayerLineState").visible = false
			if v.wechat and v.wechat.nickname and v.wechat.nickname ~= "" then
				ClickEvent._play_ui.oppositePlayerAvatarInfo:GetChild("PlayerName").text = tostring(gbk.toutf8(gbk.fromutf8(v.wechat.nickname)))
			else
				ClickEvent._play_ui.oppositePlayerAvatarInfo:GetChild("PlayerName").text = tostring(v.common_prop.name)
			end
			ClickEvent._play_ui.oppositePlayerAvatarInfo:GetChild("DouNum").text = tostring(Player.playerScore[tempX])
			ClickEvent._play_ui.oppositePlayerAvatarInfo:GetChild("AvatarLoader").url = UIPackage.GetItemURL("MXUI","Touxiang01")
			if v.wechat and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
				ClickEvent._play_ui.oppositePlayerAvatarInfo:GetChild("AvatarLoader").url = ""
				local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
				if tempTexture then
					ClickEvent._play_ui.oppositePlayerAvatarInfo:GetChild("AvatarLoader").texture = NTexture(tempTexture)
				end
			end
		elseif tempX == 3 then
			ClickEvent._play_ui.frontPlayerAvatarInfo.visible = true
			if v.position == "POSITION_TYPE_EAST" then
				ClickEvent._play_ui.frontPlayerAvatarInfo:GetChild("RoomLord").visible = true
			else
				ClickEvent._play_ui.frontPlayerAvatarInfo:GetChild("RoomLord").visible = false
			end
			ClickEvent._play_ui.frontPlayerAvatarInfo:GetChild("PlayerLineState").visible = false
			if v.wechat and v.wechat.nickname and v.wechat.nickname ~= "" then
				ClickEvent._play_ui.frontPlayerAvatarInfo:GetChild("PlayerName").text = tostring(gbk.toutf8(gbk.fromutf8(v.wechat.nickname)))
			else
				ClickEvent._play_ui.frontPlayerAvatarInfo:GetChild("PlayerName").text = tostring(v.common_prop.name)
			end
			ClickEvent._play_ui.frontPlayerAvatarInfo:GetChild("DouNum").text = tostring(Player.playerScore[tempX])
			ClickEvent._play_ui.frontPlayerAvatarInfo:GetChild("AvatarLoader").url = UIPackage.GetItemURL("MXUI","Touxiang01")
			if v.wechat and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
				ClickEvent._play_ui.frontPlayerAvatarInfo:GetChild("AvatarLoader").url = ""
				local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
				if tempTexture then
					ClickEvent._play_ui.frontPlayerAvatarInfo:GetChild("AvatarLoader").texture = NTexture(tempTexture)
				end
			end
		else
			ClickEvent._play_ui.playerAvatarInfo.visible = true
			if v.position == "POSITION_TYPE_EAST" then
				ClickEvent._play_ui.playerAvatarInfo:GetChild("RoomLord").visible = true
			else
				ClickEvent._play_ui.playerAvatarInfo:GetChild("RoomLord").visible = false
			end
			ClickEvent._play_ui.playerAvatarInfo:GetChild("PlayerLineState").visible = false
			if Player.wechat_nickname and Player.wechat_nickname ~= "" then
				ClickEvent._play_ui.playerAvatarInfo:GetChild("PlayerName").text = gbk.toutf8(gbk.fromutf8(Player.wechat_nickname))
			else
				ClickEvent._play_ui.playerAvatarInfo:GetChild("PlayerName").text = v.common_prop.name
			end
			ClickEvent._play_ui.playerAvatarInfo:GetChild("DouNum").text = tostring(Player.playerScore[0])
			ClickEvent._play_ui.playerAvatarInfo:GetChild("AvatarLoader").url = UIPackage.GetItemURL("MXUI","Touxiang01")
			Player.LogWarning(v.wechat.headimgurl)
			if v.wechat and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
				ClickEvent._play_ui.playerAvatarInfo:GetChild("AvatarLoader").url = ""
				local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
				--[[
				local headimgurl = v.wechat.headimgurl
				WeChatPlatform.func = function ()
					-- body
					local delegateTex = WeChatPlatform:SetAsyncImage(headimgurl)
					if delegateTex then
						ClickEvent._play_ui.playerAvatarInfo:GetChild("AvatarLoader").texture = NTexture(delegateTex)
					end
				end
				--]]
				if tempTexture then
					ClickEvent._play_ui.playerAvatarInfo:GetChild("AvatarLoader").texture = NTexture(tempTexture)
				end
			end
		end
	end
	if countPlayerNumber >= 4 and ClickEvent._play_ui.playerAlready.visible == false then
		if Player.hasBeginned == true then
			ClickEvent._play_ui.gamePlayButton.visible = false
		else
			ClickEvent._play_ui.gamePlayButton.visible = true
		end
		ClickEvent._play_ui.inviteWechatFriends.visible = false
		ClickEvent._play_ui.copyRoomNum.visible = false
	end
end

function ClickEvent.UpdatePlayersHeadImg( ... )
	-- body
	for k,v in pairs(Player._all_players_data) do
		local tempX = _position_index[v.position] - _position_index[Player._my_player_data.position]
		if tempX == 1 then
			ClickEvent._play_ui.behindPlayerAvatarInfo:GetChild("AvatarLoader").url = UIPackage.GetItemURL("MXUI","Touxiang01")
			if v.wechat and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
				ClickEvent._play_ui.behindPlayerAvatarInfo:GetChild("AvatarLoader").url = ""
				local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
				if tempTexture then
					ClickEvent._play_ui.behindPlayerAvatarInfo:GetChild("AvatarLoader").texture = NTexture(tempTexture)
				end
			end
		elseif tempX == 2 then
			ClickEvent._play_ui.oppositePlayerAvatarInfo:GetChild("AvatarLoader").url = UIPackage.GetItemURL("MXUI","Touxiang01")
			if v.wechat and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
				ClickEvent._play_ui.oppositePlayerAvatarInfo:GetChild("AvatarLoader").url = ""
				local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
				if tempTexture then
					ClickEvent._play_ui.oppositePlayerAvatarInfo:GetChild("AvatarLoader").texture = NTexture(tempTexture)
				end
			end
		elseif tempX == 3 then
			ClickEvent._play_ui.frontPlayerAvatarInfo:GetChild("AvatarLoader").url = UIPackage.GetItemURL("MXUI","Touxiang01")
			if v.wechat and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
				ClickEvent._play_ui.frontPlayerAvatarInfo:GetChild("AvatarLoader").url = ""
				local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
				if tempTexture then
					ClickEvent._play_ui.frontPlayerAvatarInfo:GetChild("AvatarLoader").texture = NTexture(tempTexture)
				end
			end
		else
			ClickEvent._play_ui.playerAvatarInfo:GetChild("AvatarLoader").url = UIPackage.GetItemURL("MXUI","Touxiang01")
			if v.wechat and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
				ClickEvent._play_ui.playerAvatarInfo:GetChild("AvatarLoader").url = ""
				local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
				if tempTexture then
					ClickEvent._play_ui.playerAvatarInfo:GetChild("AvatarLoader").texture = NTexture(tempTexture)
				end
			end
		end
	end
end

function ClickEvent.BankerStateUpdate(bankerPos)
	-- body
	Player.MahJong.UpdateWhoseTurn(bankerPos)
	Player._banker_position = ClickEvent.PlayerPosition(bankerPos)
	if Player._banker_position == 0 then
		ClickEvent._play_ui.selfBanker.visible = true
		ClickEvent._play_ui.nextBanker.visible = false
		ClickEvent._play_ui.oppositeBanker.visible = false
		ClickEvent._play_ui.forwardBanker.visible = false
		Player.MahJong.SetModelPoolFrontPointer(Player.MahJong.GetModelPoolFrontPointer() + 34*2)
	elseif Player._banker_position == 1 then
		ClickEvent._play_ui.selfBanker.visible = false
		ClickEvent._play_ui.nextBanker.visible = true
		ClickEvent._play_ui.oppositeBanker.visible = false
		ClickEvent._play_ui.forwardBanker.visible = false
		Player.MahJong.SetModelPoolFrontPointer(Player.MahJong.GetModelPoolFrontPointer() + 34)
	elseif Player._banker_position == 2 then
		ClickEvent._play_ui.selfBanker.visible = false
		ClickEvent._play_ui.nextBanker.visible = false
		ClickEvent._play_ui.oppositeBanker.visible = true
		ClickEvent._play_ui.forwardBanker.visible = false
		Player.MahJong.SetModelPoolFrontPointer(Player.MahJong.GetModelPoolFrontPointer())
	elseif Player._banker_position == 3 then
		ClickEvent._play_ui.selfBanker.visible = false
		ClickEvent._play_ui.nextBanker.visible = false
		ClickEvent._play_ui.oppositeBanker.visible = false
		ClickEvent._play_ui.forwardBanker.visible = true
		Player.MahJong.SetModelPoolFrontPointer(Player.MahJong.GetModelPoolFrontPointer() + 34*3)
	else
		Player.LogWarning("bankerPos nil")
	end
end

function ClickEvent.PaiOperationState()
	-- body
	local xuanfengCount = 0
	local angangCount = 0
	local tingpaiCount = 0
	Player._ting_pai_cache = {}
	if Player._operation_alert_cache.pais then
		for k,v in pairs(Player._operation_alert_cache.pais) do
			for j,m in pairs(v.oper_list) do
				if m == "PAI_OPER_TYPE_ANGANGPAI" then
					angangCount = angangCount + 1
				elseif m == "PAI_OPER_TYPE_XUANFENG_FENG" or m == "PAI_OPER_TYPE_XUANFENG_JIAN" then
					xuanfengCount = xuanfengCount + 1
				elseif m == "PAI_OPER_TYPE_TINGPAI" then
					if v.pai and v.pai.card_value then
						tingpaiCount = tingpaiCount + 1
						Player._ting_pai_cache[tingpaiCount] = {}
						Player._ting_pai_cache[tingpaiCount].card_type = v.pai.card_type
						Player._ting_pai_cache[tingpaiCount].card_value = v.pai.card_value
					end
				end
			end
		end
	end

    for k,v in pairs(Player._operation_alert_cache.pais) do
    	for j,m in pairs(v.oper_list) do
	    	Player.LogWarning(m)
	    	ClickEvent._play_ui.passButton.visible = true
			if m == "PAI_OPER_TYPE_HUPAI" then
				ClickEvent.AddOperationButton("GameHuButton")
		        --Player.MahJong.SetCurrentState(operationState.HU)
			elseif m == "PAI_OPER_TYPE_GANGPAI" then
				ClickEvent.AddOperationButton("GameGangButton")
		        Player.MahJong.SetCurrentState(operationState.GANG)
		        Player.MahJong.ShowMabeOperationEffect()
			elseif m == "PAI_OPER_TYPE_PENGPAI" then
				ClickEvent.AddOperationButton("GamePengButton")
		        Player.MahJong.SetCurrentState(operationState.PENG)
		        Player.MahJong.ShowMabeOperationEffect()
			elseif m == "PAI_OPER_TYPE_CHIPAI" then
				ClickEvent.AddOperationButton("GameChiButton")
				Player.MahJong.SetCurrentState(operationState.CHI)
				Player.MahJong.ShowMabeOperationEffect()
			elseif m == "PAI_OPER_TYPE_ANGANGPAI" then
				Player.LogWarning("ANGANG")
				--Player.MahJong.SetCurrentState(operationState.ANGANG)
				ClickEvent.AddOperationButton("GameGangButton")
			elseif m == "PAI_OPER_TYPE_XUANFENG_FENG" then
				Player.LogWarning("XuanFengButton")
				--Player.MahJong.SetCurrentState(operationState.XUANFENGGANGFENG)
				if xuanfengCount > 1 then
					v.pai.card_type = "PAI_OPER_TYPE_XUANFENG_FENG"
					v.pai.card_value = 1
					Player.MahJong.CreateGangPai(v.pai)
				else
					ClickEvent.AddOperationButton("XuanFengButton")
				end
			elseif m == "PAI_OPER_TYPE_XUANFENG_JIAN" then
				Player.LogWarning("XuanFengButton")
				--Player.MahJong.SetCurrentState(operationState.XUANFENGGANGJIAN)
				if xuanfengCount > 1 then
					v.pai.card_type = "PAI_OPER_TYPE_XUANFENG_JIAN"
					v.pai.card_value = 1
					Player.MahJong.CreateGangPai(v.pai)
				else
					ClickEvent.AddOperationButton("XuanFengButton")
				end
			elseif m == "PAI_OPER_TYPE_TINGPAI" then
				Player.LogWarning("tingpai")
				Player.MahJong.SetCurrentState(operationState.TINGPAI)
			elseif m == "PAI_OPER_TYPE_BAOPAI" then
				
			else
		    	ClickEvent._play_ui.passButton.visible = false
				Player.LogWarning("PAI_OPER_TYPE_BEGIN ")
				Player.LogWarning(ClickEvent.MahJong.GetCurrentState())
			end
    	end
    end
    Player.LogWarning("tingpaiCount"..tingpaiCount)
    if tingpaiCount > 0 then
    	ClickEvent._play_ui.cancelButton.visible = true
    	ClickEvent._play_ui.passButton.visible = false
		ClickEvent.AddOperationButton("GameTingButton")
    end
    Player.MahJong.SetStateTable({})
end

function ClickEvent.ErrorChangeTable(errorCode)
	-- body
	local errorTable = {
		ERROR_SUCCESS = 0,
		ERROR_INNER = 1,
		ERROR_DIAMOND_NOT_ENOUGH = 2,
		ERROR_HUANLEDOU_NOT_ENOUGH = 3,
		ERROR_INVENTORY_FULL = 4,
		ERROR_REWARD_HAS_GOT = 5,
		ERROR_HUANLEDOU_LIMIT = 6,
		ERROR_MALL_NOT_FOUND = 7,
		ERROR_ACTIVITY_NOT_OPEN = 8,
		ERROR_CLIENT_DATA = 9,
		ERROR_HAS_NO_PLAYER = 10,
		ERROR_DATABASE = 11,
		ERROR_ROOM_CARD_NOT_ENOUGH = 12,

		ERROR_ROOM_NOT_FOUNT = 20,
		ERROR_ROOM_PASSWORD = 21,
		ERROR_ROOM_IS_FULL = 22,
		ERROR_ROOM_NOT_AVAILABLE = 23,
		ERROR_ROOM_NO_PERMISSION = 24,
		ERROR_ROOM_BEANS_MIN_LIMIT = 25,
		ERROR_ROOM_BEANS_MAX_LIMIT = 26,
		ERROR_ROOM_TYPE_NOT_FOUND = 27,
		ERROR_ROOM_HAS_BEEN_IN = 28,
		ERROR_ROOM_GUEST_FORBID_ENTER = 29,
		ERROR_ROOM_CARD_GAMES_FULL = 30,
		
		ERROR_GAME_NO_PERMISSION = 40,
		ERROR_GAME_PAI_UNSATISFIED = 41,
		
		ERROR_COMMON_REWARD_DATA = 50,
		ERROR_COMMON_REWARD_HAS_GOT = 51,
	}
	fSwitch = errorTable[errorCode]
	if fSwitch then
		return fSwitch
	else
		return -1
	end
end

function ClickEvent.ShowToast(content)
	-- body
	if CS.UnityEngine.Application.loadedLevelName == "PlaySence" then
		ClickEvent.PopPanel(ClickEvent.panelTable._toast_ui,true)
	else
		ClickEvent.PopPanel(ClickEvent.panelTable._toast_ui)
	end
	_popPanel[popPanelIndex].panel:GetTransition("ToastMove"):Play(ClickEvent.Close)
	if ClickEvent.ErrorChangeTable(content) ~= -1 then
		_popPanel[popPanelIndex].panel:GetChild("n0"):GetChild("Text").text = StringTable.Get(ClickEvent.ErrorChangeTable(content))
	else
		_popPanel[popPanelIndex].panel:GetChild("n0"):GetChild("Text").text = content
	end
end

function ClickEvent.ShowNotMoveToast(content,deleteTime)
	-- body
	ClickEvent.Close()
	ClickEvent.PopPanel(ClickEvent.panelTable._not_move_toast_ui)
	_popPanel[popPanelIndex].panel:GetChild("n0"):GetChild("Text").text = StringTable.Get(content)
	if deleteTime then
		local co = coroutine.create(function()
	    yield_return(CS.UnityEngine.WaitForSeconds(deleteTime))
	    ClickEvent.Close()
		end)
		coroutine.resume(co)
	end
end

function ClickEvent.ShowChiButton()
	-- body
	ClickEvent.AddOperationButton("GameChiButton")
end

function ClickEvent.PopPanelShowText(textName,content)
	-- body
	if popPanelIndex > 0 then
		_popPanel[popPanelIndex].panel:GetChild(textName).text = content
	end
end

function ClickEvent.PopPanel( panelName , noBack)
	-- body
	if not ClickEvent._createObject["Bg"] then
		ClickEvent._createObject["Bg"] = {}
	end
	if not ClickEvent._createObject[panelName] then
		ClickEvent._createObject[panelName] = UIPackage.CreateObject("MXUI", panelName).asCom
	end
	--ClickEvent.Close()
	popPanelIndex = popPanelIndex + 1
	_popPanel[popPanelIndex] = {}
	if not noBack then
		if popBgIndex <= 0 or not ClickEvent._createObject["Bg"][popBgIndex] or ClickEvent._createObject["Bg"][popBgIndex].visible == true then
			popBgIndex = popBgIndex + 1
			if not ClickEvent._createObject["Bg"][popBgIndex] then
				ClickEvent._createObject["Bg"][popBgIndex] = UIPackage.CreateObject("MXUI", "Bg").asCom
			end
		end
		_popPanel[popPanelIndex].background = ClickEvent._createObject["Bg"][popBgIndex]
		_popPanel[popPanelIndex].background:SetSize(GRoot.inst.width, GRoot.inst.height)
		_popPanel[popPanelIndex].background:Center()
		_popPanel[popPanelIndex].background:SetPosition(0,0,0)
		_popPanel[popPanelIndex].background.onTouchBegin:Add(ClickEvent.registerButtonDown)
		_popPanel[popPanelIndex].background.onTouchEnd:Add(ClickEvent.registerButtonUp)
		GRoot.inst:AddChild(_popPanel[popPanelIndex].background)
	end

	_popPanel[popPanelIndex].panel = ClickEvent._createObject[panelName]
	_popPanel[popPanelIndex].panel.name = panelName
	_popPanel[popPanelIndex].panel:SetSize(GRoot.inst.width, GRoot.inst.height)
	_popPanel[popPanelIndex].panel:Center()
	_popPanel[popPanelIndex].panel:SetPosition(0,0,0)
	GRoot.inst:AddChild(_popPanel[popPanelIndex].panel)
	--GRoot.inst:RemoveChild(_popPanel[popPanelIndex].panel)
	--GRoot.inst:AddChild(_popPanel[popPanelIndex].panel)
	local childNumber = _popPanel[popPanelIndex].panel.numChildren
	for i=0,childNumber-1 do
		local obj = _popPanel[popPanelIndex].panel:GetChildAt(i)
		if obj.group and obj.group.name == "Btns" then
			obj.onClick:Add(ClickEvent.registerButtonClick)
		end
	end
	if panelName == ClickEvent.panelTable._create_room_ui then
		local x = 1/ClickEvent.scale
		Effect.AddUIEffect(Effect._effect_name.button_ui,CS.UnityEngine.Vector3(100,100,100),_popPanel[popPanelIndex].panel:GetChild("CreateButton"),_popPanel[popPanelIndex].panel:GetChild("CreateButton").size/2)
	end
	--[[
	local image = _popPanel[popPanelIndex].background:GetChild("Di")
	LogWarning(image.displayObject.gameObject:GetComponent("Renderer").bounds.size.x)
	LogWarning(_currentPanel.panel:GetChild("Bg").displayObject.gameObject:GetComponent("Renderer").bounds.size.x)
	LogWarning(image.displayObject.size.x * ClickEvent.scale)
	if panelName == ClickEvent.panelTable._create_room_ui and addEffect then
		Effect.AddUIEffect("Effect_UI_button_02",CS.UnityEngine.Vector3(100,100,100),_popPanel[popPanelIndex].panel:GetChild("CreateButton"),image.displayObject.gameObject)
	end
	local tempObj = CS.UnityEngine.Resources.Load("UIPrefab/"..panelName)
	_popPanel[popPanelIndex].panel = CS.UnityEngine.Object.Instantiate(tempObj,ClickEvent.self.transform)
	_popPanel[popPanelIndex].panel.transform.localScale = CS.UnityEngine.Vector3.one
	_popPanel[popPanelIndex].eventTriggerListener = _popPanel[popPanelIndex].panel:GetComponent("EventTriggerListener")
	_popPanel[popPanelIndex].eventTriggerListener.onClick = ClickEvent.registerButtonClick
	_popPanel[popPanelIndex].buttonList = _popPanel[popPanelIndex].eventTriggerListener._buttons
	_popPanel[popPanelIndex].toggleList = _popPanel[popPanelIndex].eventTriggerListener._toggles
	--]]
end

function ClickEvent.DestroyPanel(gameObject)
	-- body
	CS.UnityEngine.Object.Destroy(gameObject)
	if _popPanel then
		_popPanel = {}
	else
		_currentPanel = {}
	end
end

function ClickEvent.ShowRoomCalculate( ... )
	-- body
	if not Player._room_calculate_data then
		return
	end
	ClickEvent.PopPanel(ClickEvent.panelTable._room_calculate_ui)
	local bigWinScore = nil
	local superPaoCount = nil
	for k,v in pairs(Player._room_calculate_data.record) do
		if not bigWinScore then
			bigWinScore = v.score
		end
		if not superPaoCount then
			superPaoCount = v.dianpao_count
		end
		if bigWinScore and bigWinScore < v.score then
			bigWinScore = v.score
		end
		if superPaoCount and superPaoCount < v.dianpao_count then
			superPaoCount = v.dianpao_count
		end
	end
	--_popPanel[popPanelIndex].panel:GetChild("ShareRank").visible = false
	local listObj = _popPanel[popPanelIndex].panel:GetChild("FinishBalanceList")
	listObj:RemoveChildrenToPool()
	for k,v in pairs(Player._room_calculate_data.record) do
		local obj = listObj:AddItemFromPool(UIPackage.GetItemURL("MXUI","FinishBalanceUnit"))
		obj.name = "FinishBalanceUnit"
		obj:GetChild("UserID").text = tostring(v.player_id)
		obj:GetChild("Name").text = tostring(gbk.toutf8(gbk.fromutf8(v.nickname)))
		obj:GetChild("RoundNum").text = tostring(v.pk_count)
		obj:GetChild("BankerNum").text = tostring(v.banker_count)
		obj:GetChild("WinNum").text = tostring(v.win_count)
		obj:GetChild("PaoNum").text = tostring(v.dianpao_count)
		obj:GetChild("TotalNum").text = tostring(v.score)
		obj:GetChild("AvatarLoader").url = UIPackage.GetItemURL("MXUI","Touxiang01")
		if v.headimgurl and v.headimgurl ~= "" then
			local delegateTex = WeChatPlatform:SetAsyncImage(v.headimgurl)
			if delegateTex then
				obj:GetChild("AvatarLoader").url = ""
				obj:GetChild("AvatarLoader").texture = NTexture(delegateTex)
			end
		end
		if v.dianpao_count >= superPaoCount then
			obj:GetChild("MedalLoader").url = UIPackage.GetItemURL("MXUI","tubiao_paoshen")
		end
		if v.score >= bigWinScore then
			obj:GetChild("MedalLoader").url = UIPackage.GetItemURL("MXUI","tubiao_dayingjia")
		end
	end
end

function ClickEvent.ShareRank( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._share_calculate_ui)
	local scoreList = _popPanel[popPanelIndex].panel:GetChild("HistoryShareList")
	scoreList:RemoveChildrenToPool()
	local countScore = {}
	for i=1,4 do
		countScore[i] = {}
		countScore[i].nickname = ""
		countScore[i].headimgurl = ""
		countScore[i].allScore = 0
		countScore[i].roundNumber = 0
	end
	local playerNumber = 1
	for k,v in pairs(Player._room_calculate_data.record) do
		countScore[playerNumber].nickname = gbk.toutf8(gbk.fromutf8(v.nickname))
		countScore[playerNumber].headimgurl = v.headimgurl
		countScore[playerNumber].allScore = v.score
		countScore[playerNumber].roundNumber = v.pk_count
		playerNumber = playerNumber + 1
	end
	for i=1,4 do
		local tempTable = {}
		for j=i,4 do
			if countScore[i].allScore < countScore[j].allScore then
				tempTable = countScore[i]
				countScore[i] = countScore[j]
				countScore[j] = tempTable
			end
		end
	end
	for i=1,4 do
		local obj = scoreList:AddItemFromPool(UIPackage.GetItemURL("MXUI","VipNoteListInTotal"))
		obj.name = "VipNoteListInTotal"
		obj:GetChild("Rank").text = tostring(i)
		if countScore[i].allScore < 0 then
			local loseFont = obj:GetChild("VipNoteListTotalUnit"):GetChild("WinLoseNum").textFormat
			loseFont.font = UIPackage.GetItemURL("MXUI","LoseFont")
			obj:GetChild("VipNoteListTotalUnit"):GetChild("WinLoseNum").textFormat = loseFont
			obj:GetChild("VipNoteListTotalUnit"):GetChild("WinLoseNum").text = tostring(countScore[i].allScore)
		else
			local winFont = obj:GetChild("VipNoteListTotalUnit"):GetChild("WinLoseNum").textFormat
			winFont.font = UIPackage.GetItemURL("MXUI","WinFont")
			obj:GetChild("VipNoteListTotalUnit"):GetChild("WinLoseNum").textFormat = winFont
			obj:GetChild("VipNoteListTotalUnit"):GetChild("WinLoseNum").text = tostring(countScore[i].allScore)
		end
		obj:GetChild("VipNoteListTotalUnit"):GetChild("PlayerName").text = tostring(countScore[i].nickname)
		if countScore[i].headimgurl and countScore[i].headimgurl ~= "" then
			local tempTexture = WeChatPlatform:SetAsyncImage(countScore[i].headimgurl)
			if tempTexture then
				obj:GetChild("VipNoteListTotalUnit"):GetChild("AvatarLoader").texture = NTexture(tempTexture)
			end
		end
		obj:GetChild("VipNoteListTotalUnit"):GetChild("TotalRoundNum").text = tostring(countScore[i].roundNumber)
	end
end

function ClickEvent.ShareToWeChatFriends( ... )
	-- body
	local radio = CS.UnityEngine.Screen.width/CS.UnityEngine.Screen.height
	_popPanel[popPanelIndex].panel:GetChild("ShareToWeChatFriends").visible = false
	_popPanel[popPanelIndex].panel:GetChild("ShareToWeChat").visible = false
	_popPanel[popPanelIndex].panel:GetChild("GameBackButton").visible = false
	WeChatPlatform:ShareTexture(StageCamera.main, CS.UnityEngine.Rect(0,0,240 * radio,240),2)
	_popPanel[popPanelIndex].panel:GetChild("ShareToWeChatFriends").visible = true
	_popPanel[popPanelIndex].panel:GetChild("ShareToWeChat").visible = true
	_popPanel[popPanelIndex].panel:GetChild("GameBackButton").visible = true
end

function ClickEvent.ShareToWeChat( ... )
	-- body
	local radio = CS.UnityEngine.Screen.width/CS.UnityEngine.Screen.height
	_popPanel[popPanelIndex].panel:GetChild("ShareToWeChatFriends").visible = false
	_popPanel[popPanelIndex].panel:GetChild("ShareToWeChat").visible = false
	_popPanel[popPanelIndex].panel:GetChild("GameBackButton").visible = false
	WeChatPlatform:ShareTexture(StageCamera.main, CS.UnityEngine.Rect(0,0,240 * radio,240),1)
	_popPanel[popPanelIndex].panel:GetChild("ShareToWeChatFriends").visible = true
	_popPanel[popPanelIndex].panel:GetChild("ShareToWeChat").visible = true
	_popPanel[popPanelIndex].panel:GetChild("GameBackButton").visible = true
end

function ClickEvent.ExitRoomButton( ... )
	-- body
	--Player.returnMainUI = true
	Player.CmdGameOperation("GAME_OPER_TYPE_LEAVE")
	--Player.MahJong.QuitVoiceRoom()
	--Player.LoadScene("FairyMainUI")
end

function ClickEvent.ShowCalculate( ... )
	-- body
	if not Player._calculate_data or not Player._all_players_data or not Player._my_player_data.position then
		return
	end
	local myPosition = Player._my_player_data.position
	local currentPositionData
	ClickEvent.PopPanel(ClickEvent.panelTable._calculate_ui)
	if Player._banker_position then
		_popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("Zhuang").visible = false
		_popPanel[popPanelIndex].panel:GetChild("BehindPlayerClearInfo"):GetChild("Zhuang").visible = false
		_popPanel[popPanelIndex].panel:GetChild("OppositePlayerClearInfo"):GetChild("Zhuang").visible = false
		_popPanel[popPanelIndex].panel:GetChild("FrontPlayerClearInfo"):GetChild("Zhuang").visible = false
		if Player._banker_position == 1 then
			_popPanel[popPanelIndex].panel:GetChild("BehindPlayerClearInfo"):GetChild("Zhuang").visible = true
		elseif Player._banker_position == 2 then
			_popPanel[popPanelIndex].panel:GetChild("OppositePlayerClearInfo"):GetChild("Zhuang").visible = true
		elseif Player._banker_position == 3 then
			_popPanel[popPanelIndex].panel:GetChild("FrontPlayerClearInfo"):GetChild("Zhuang").visible = true
		else
			_popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("Zhuang").visible = true
		end
	end
	_popPanel[popPanelIndex].panel:GetChild("BehindPlayerClearInfo"):GetChild("ClearState"):GetController("ClearState").selectedIndex = 2
	_popPanel[popPanelIndex].panel:GetChild("BehindPlayerClearInfo"):GetChild("HuZhang").visible = false
	_popPanel[popPanelIndex].panel:GetChild("OppositePlayerClearInfo"):GetChild("ClearState"):GetController("ClearState").selectedIndex = 2
	_popPanel[popPanelIndex].panel:GetChild("OppositePlayerClearInfo"):GetChild("HuZhang").visible = false
	_popPanel[popPanelIndex].panel:GetChild("FrontPlayerClearInfo"):GetChild("ClearState"):GetController("ClearState").selectedIndex = 2
	_popPanel[popPanelIndex].panel:GetChild("FrontPlayerClearInfo"):GetChild("HuZhang").visible = false
	_popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("ClearState"):GetController("ClearState").selectedIndex = 2
	_popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("HuZhang").visible = false

	if Player._calculate_data.dianpao_player_position and Player._calculate_data.dianpao_player_position ~= "" and Player._calculate_data.dianpao_player_position ~= "POSITION_TYPE_NULL" then
		local dianpaoPosition = ClickEvent.PlayerPosition(Player._calculate_data.dianpao_player_position)
		if dianpaoPosition == 0 then
			_popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("ClearState"):GetController("ClearState").selectedIndex = 1
		elseif dianpaoPosition == 1 then
			_popPanel[popPanelIndex].panel:GetChild("BehindPlayerClearInfo"):GetChild("ClearState"):GetController("ClearState").selectedIndex = 1
		elseif dianpaoPosition == 2 then
			_popPanel[popPanelIndex].panel:GetChild("OppositePlayerClearInfo"):GetChild("ClearState"):GetController("ClearState").selectedIndex = 1
		elseif dianpaoPosition == 3 then
			_popPanel[popPanelIndex].panel:GetChild("FrontPlayerClearInfo"):GetChild("ClearState"):GetController("ClearState").selectedIndex = 1
		end
	end
	if Player.huPaiPosition == 0 then
		_popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("ClearState"):GetController("ClearState").selectedIndex = 0
		_popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("HuZhang").visible = true
		_popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("HuZhang"):GetChild("BaoPaiLoader").url = UIPackage.GetItemURL("MXUI",Player.hupai_calculate_data.card_type.."_"..Player.hupai_calculate_data.card_value)
	elseif Player.huPaiPosition == 1 then
		_popPanel[popPanelIndex].panel:GetChild("BehindPlayerClearInfo"):GetChild("ClearState"):GetController("ClearState").selectedIndex = 0
		_popPanel[popPanelIndex].panel:GetChild("BehindPlayerClearInfo"):GetChild("HuZhang").visible = true
		_popPanel[popPanelIndex].panel:GetChild("BehindPlayerClearInfo"):GetChild("HuZhang"):GetChild("BaoPaiLoader").url = UIPackage.GetItemURL("MXUI",Player.hupai_calculate_data.card_type.."_"..Player.hupai_calculate_data.card_value)
	elseif Player.huPaiPosition == 2 then
		_popPanel[popPanelIndex].panel:GetChild("OppositePlayerClearInfo"):GetChild("ClearState"):GetController("ClearState").selectedIndex = 0
		_popPanel[popPanelIndex].panel:GetChild("OppositePlayerClearInfo"):GetChild("HuZhang").visible = true
		_popPanel[popPanelIndex].panel:GetChild("OppositePlayerClearInfo"):GetChild("HuZhang"):GetChild("BaoPaiLoader").url = UIPackage.GetItemURL("MXUI",Player.hupai_calculate_data.card_type.."_"..Player.hupai_calculate_data.card_value)
	elseif Player.huPaiPosition == 3 then
		_popPanel[popPanelIndex].panel:GetChild("FrontPlayerClearInfo"):GetChild("ClearState"):GetController("ClearState").selectedIndex = 0
		_popPanel[popPanelIndex].panel:GetChild("FrontPlayerClearInfo"):GetChild("HuZhang").visible = true
		_popPanel[popPanelIndex].panel:GetChild("FrontPlayerClearInfo"):GetChild("HuZhang"):GetChild("BaoPaiLoader").url = UIPackage.GetItemURL("MXUI",Player.hupai_calculate_data.card_type.."_"..Player.hupai_calculate_data.card_value)
	else
	end

	if Player._calculate_data.baopai and Player._calculate_data.baopai ~= {} then
		_popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("BaoPai").visible = true
		_popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("Cbg1").visible = true
		_popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("n20").visible = true
		_popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("BaoPai"):GetChild("BaoPaiLoader").url = UIPackage.GetItemURL("MXUI",Player._calculate_data.baopai.card_type.."_"..Player._calculate_data.baopai.card_value)
	else
		_popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("BaoPai").visible = false
		_popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("Cbg1").visible = false
		_popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("n20").visible = false
	end
	for k,v in pairs(Player._calculate_data.record.list) do
		for j,m in pairs(Player._all_players_data) do
			if v.player_id == m.common_prop.player_id then
				currentPositionData = m
				break
			end
		end
		local tempX = _position_index[currentPositionData.position] - _position_index[myPosition]
		Player.playerScore[tempX] = Player.playerScore[tempX] + v.score
		if tempX == 1 then
			_popPanel[popPanelIndex].panel:GetChild("BehindPlayerClearInfo"):GetChild("PlayerName").text = tostring(gbk.toutf8(gbk.fromutf8(v.nickname)))
			_popPanel[popPanelIndex].panel:GetChild("BehindPlayerClearInfo"):GetChild("DouNum").text = tostring(v.score)
			_popPanel[popPanelIndex].panel:GetChild("BehindPlayerClearInfo"):GetChild("PlayerID").text = tostring(v.player_id)

			local paiList = _popPanel[popPanelIndex].panel:GetChild("BehindPlayerClearInfo"):GetChild("PaiList")
			paiList:RemoveChildrenToPool()
			for i=1,Player.operation_calculate_data[tempX].operationNumber do
				if Player.operation_calculate_data[1][i].oper_type == "PAI_OPER_TYPE_CHIPAI" or Player.operation_calculate_data[1][i].oper_type == "PAI_OPER_TYPE_PENGPAI" or Player.operation_calculate_data[1][i].oper_type == "PAI_OPER_TYPE_XUANFENG_JIAN" then
					local listChild = paiList:AddItemFromPool(UIPackage.GetItemURL("MXUI","ChiPaiInList"))
					for j=1,3 do
						listChild:GetChild("ChiPaiLoader0"..tostring(j)).url = UIPackage.GetItemURL("MXUI",Player.operation_calculate_data[tempX][i].card_type.."_"..Player.operation_calculate_data[tempX][i].card_value[j])
					end
				else
					local listChild = paiList:AddItemFromPool(UIPackage.GetItemURL("MXUI","GangPaiInList"))
					for j=1,4 do
						listChild:GetChild("ChiPaiLoader0"..tostring(j)).url = UIPackage.GetItemURL("MXUI",Player.operation_calculate_data[tempX][i].card_type.."_"..Player.operation_calculate_data[tempX][i].card_value[j])
					end
				end
			end
			local playerHandPaiList = paiList:AddItemFromPool(UIPackage.GetItemURL("MXUI","PaiSingleList"))
			local paiSingleList = playerHandPaiList:GetChild("PaiList")
			paiSingleList:RemoveChildrenToPool()
			for dataKey,data in pairs(Player.pai_push_down) do
				local playerPos = ClickEvent.PlayerPosition(data.position)
				if playerPos == 1 then
					for paiKey,paiData in pairs(data.pai_list) do
						for valueKay,value in pairs(paiData.cards) do
							local singleChild = paiSingleList:AddItemFromPool(UIPackage.GetItemURL("MXUI","PaiSingleInList"))
							singleChild:GetChild("ChiPaiLoader01").url = UIPackage.GetItemURL("MXUI",paiData.card_type.."_"..value)
						end
					end
				end
			end

			local allFanNumber = 0
			local detailList = _popPanel[popPanelIndex].panel:GetChild("BehindPlayerClearInfo"):GetChild("FanList")
			detailList:RemoveChildrenToPool()
			local typeNumber = 0
			for countKey,countNum in pairs(v.details) do
				if countNum.fan_type ~= "FAN_TYPE_MING_GANG" and countNum.fan_type ~= "FAN_TYPE_AN_GANG" and countNum.fan_type ~= "FAN_TYPE_XUAN_FENG_GANG" then
					typeNumber = typeNumber + 1
				end
			end
			for i,c in pairs(v.details) do
				local fanName = ""
				local fanNum = 0
				for a,b in pairs(Player._calculate_table_loader) do
					for a1,b1 in pairs(b.fans) do
						if c.fan_type == b1.fan_type then
							fanName = b1.name
							fanNum = b1.multiple
							if c.fan_type ~= "FAN_TYPE_XUAN_FENG_GANG" then
								allFanNumber = allFanNumber + fanNum
							end
							break
						end
					end
				end
				if c.fan_type ~= "FAN_TYPE_MING_GANG" and c.fan_type ~= "FAN_TYPE_AN_GANG" and c.fan_type ~= "FAN_TYPE_XUAN_FENG_GANG" and c.fan_type ~= "FAN_TYPE_PINGHU" and fanNum == 0 then
					Player.LogWarning("0 fan")
				else
					if c.fan_type == "FAN_TYPE_PINGHU" and typeNumber ~= 1 then
						Player.LogWarning("many fantype")
					else
						local listChild = detailList:AddItemFromPool(_currentPanel.buttonList["ClearShowFan"])
						listChild.name = ""..i
						listChild:GetChild("FanName").text = gbk.toutf8(fanName)
						if c.fan_type == "FAN_TYPE_AN_GANG" or c.fan_type == "FAN_TYPE_MING_GANG" or c.fan_type == "FAN_TYPE_XUAN_FENG_GANG" then
							if c.score > 0 then
								listChild:GetChild("FanNum").text = "+"..tostring(c.score)
							else
								listChild:GetChild("FanNum").text = tostring(c.score)
							end
						else
							listChild:GetChild("FanNum").text = tostring(fanNum).."番"
						end
					end
				end

				--[[
				if c.score < 0 then
					listChild:GetChild("FanDou").text = ""..c.score
				else
					listChild:GetChild("FanDou").text = "+"..c.score
				end
				--]]
				--listChild:GetChild("FanPlayer").text = "+"..c.score
			end
			_popPanel[popPanelIndex].panel:GetChild("BehindPlayerClearInfo"):GetChild("TotalFanNum").text = tostring(allFanNumber)
		elseif tempX == 2 then
			_popPanel[popPanelIndex].panel:GetChild("OppositePlayerClearInfo"):GetChild("PlayerName").text = tostring(gbk.toutf8(gbk.fromutf8(v.nickname)))
			_popPanel[popPanelIndex].panel:GetChild("OppositePlayerClearInfo"):GetChild("DouNum").text = tostring(v.score)
			_popPanel[popPanelIndex].panel:GetChild("OppositePlayerClearInfo"):GetChild("PlayerID").text = tostring(v.player_id)

			local paiList = _popPanel[popPanelIndex].panel:GetChild("OppositePlayerClearInfo"):GetChild("PaiList")
			paiList:RemoveChildrenToPool()
			for i=1,Player.operation_calculate_data[tempX].operationNumber do
				if Player.operation_calculate_data[2][i].oper_type == "PAI_OPER_TYPE_CHIPAI" or Player.operation_calculate_data[2][i].oper_type == "PAI_OPER_TYPE_PENGPAI" or Player.operation_calculate_data[2][i].oper_type == "PAI_OPER_TYPE_XUANFENG_JIAN" then
					local listChild = paiList:AddItemFromPool(UIPackage.GetItemURL("MXUI","ChiPaiInList"))
					for j=1,3 do
						listChild:GetChild("ChiPaiLoader0"..tostring(j)).url = UIPackage.GetItemURL("MXUI",Player.operation_calculate_data[tempX][i].card_type.."_"..Player.operation_calculate_data[tempX][i].card_value[j])
					end
				else
					local listChild = paiList:AddItemFromPool(UIPackage.GetItemURL("MXUI","GangPaiInList"))
					for j=1,4 do
						listChild:GetChild("ChiPaiLoader0"..tostring(j)).url = UIPackage.GetItemURL("MXUI",Player.operation_calculate_data[tempX][i].card_type.."_"..Player.operation_calculate_data[tempX][i].card_value[j])
					end
				end
			end
			local playerHandPaiList = paiList:AddItemFromPool(UIPackage.GetItemURL("MXUI","PaiSingleList"))
			local paiSingleList = playerHandPaiList:GetChild("PaiList")
			paiSingleList:RemoveChildrenToPool()
			for dataKey,data in pairs(Player.pai_push_down) do
				local playerPos = ClickEvent.PlayerPosition(data.position)
				if playerPos == 2 then
					for paiKey,paiData in pairs(data.pai_list) do
						for valueKay,value in pairs(paiData.cards) do
							local singleChild = paiSingleList:AddItemFromPool(UIPackage.GetItemURL("MXUI","PaiSingleInList"))
							singleChild:GetChild("ChiPaiLoader01").url = UIPackage.GetItemURL("MXUI",paiData.card_type.."_"..value)
						end
					end
				end
			end

			local allFanNumber = 0
			local detailList = _popPanel[popPanelIndex].panel:GetChild("OppositePlayerClearInfo"):GetChild("FanList")
			detailList:RemoveChildrenToPool()
			local typeNumber = 0
			for countKey,countNum in pairs(v.details) do
				if countNum.fan_type ~= "FAN_TYPE_MING_GANG" and countNum.fan_type ~= "FAN_TYPE_AN_GANG" and countNum.fan_type ~= "FAN_TYPE_XUAN_FENG_GANG" then
					typeNumber = typeNumber + 1
				end
			end
			for i,c in pairs(v.details) do
				local fanName = ""
				local fanNum = 0
				for a,b in pairs(Player._calculate_table_loader) do
					for a1,b1 in pairs(b.fans) do
						if c.fan_type == b1.fan_type then
							fanName = b1.name
							fanNum = b1.multiple
							if c.fan_type ~= "FAN_TYPE_XUAN_FENG_GANG" then
								allFanNumber = allFanNumber + fanNum
							end
							break
						end
					end
				end
				if c.fan_type ~= "FAN_TYPE_MING_GANG" and c.fan_type ~= "FAN_TYPE_AN_GANG" and c.fan_type ~= "FAN_TYPE_XUAN_FENG_GANG" and c.fan_type ~= "FAN_TYPE_PINGHU" and fanNum == 0 then
					Player.LogWarning("0 fan")
				else
					if c.fan_type == "FAN_TYPE_PINGHU" and typeNumber ~= 1 then
						Player.LogWarning("many fantype")
					else
						local listChild = detailList:AddItemFromPool(_currentPanel.buttonList["ClearShowFan"])
						listChild.name = ""..i
						listChild:GetChild("FanName").text = gbk.toutf8(fanName)
						if c.fan_type == "FAN_TYPE_AN_GANG" or c.fan_type == "FAN_TYPE_MING_GANG" or c.fan_type == "FAN_TYPE_XUAN_FENG_GANG" then
							if c.score > 0 then
								listChild:GetChild("FanNum").text = "+"..tostring(c.score)
							else
								listChild:GetChild("FanNum").text = tostring(c.score)
							end
						else
							listChild:GetChild("FanNum").text = tostring(fanNum).."番"
						end
					end
				end

				--[[
				if c.score < 0 then
					listChild:GetChild("FanDou").text = ""..c.score
				else
					listChild:GetChild("FanDou").text = "+"..c.score
				end
				--]]
				--listChild:GetChild("FanPlayer").text = "+"..c.score
			end
			_popPanel[popPanelIndex].panel:GetChild("OppositePlayerClearInfo"):GetChild("TotalFanNum").text = tostring(allFanNumber)
		elseif tempX == 3 then
			_popPanel[popPanelIndex].panel:GetChild("FrontPlayerClearInfo"):GetChild("PlayerName").text = tostring(gbk.toutf8(gbk.fromutf8(v.nickname)))
			_popPanel[popPanelIndex].panel:GetChild("FrontPlayerClearInfo"):GetChild("DouNum").text = tostring(v.score)
			_popPanel[popPanelIndex].panel:GetChild("FrontPlayerClearInfo"):GetChild("PlayerID").text = tostring(v.player_id)

			local paiList = _popPanel[popPanelIndex].panel:GetChild("FrontPlayerClearInfo"):GetChild("PaiList")
			paiList:RemoveChildrenToPool()
			for i=1,Player.operation_calculate_data[tempX].operationNumber do
				if Player.operation_calculate_data[3][i].oper_type == "PAI_OPER_TYPE_CHIPAI" or Player.operation_calculate_data[3][i].oper_type == "PAI_OPER_TYPE_PENGPAI" or Player.operation_calculate_data[3][i].oper_type == "PAI_OPER_TYPE_XUANFENG_JIAN" then
					local listChild = paiList:AddItemFromPool(UIPackage.GetItemURL("MXUI","ChiPaiInList"))
					for j=1,3 do
						listChild:GetChild("ChiPaiLoader0"..tostring(j)).url = UIPackage.GetItemURL("MXUI",Player.operation_calculate_data[tempX][i].card_type.."_"..Player.operation_calculate_data[tempX][i].card_value[j])
					end
				else
					local listChild = paiList:AddItemFromPool(UIPackage.GetItemURL("MXUI","GangPaiInList"))
					for j=1,4 do
						listChild:GetChild("ChiPaiLoader0"..tostring(j)).url = UIPackage.GetItemURL("MXUI",Player.operation_calculate_data[tempX][i].card_type.."_"..Player.operation_calculate_data[tempX][i].card_value[j])
					end
				end
			end
			local playerHandPaiList = paiList:AddItemFromPool(UIPackage.GetItemURL("MXUI","PaiSingleList"))
			local paiSingleList = playerHandPaiList:GetChild("PaiList")
			paiSingleList:RemoveChildrenToPool()
			for dataKey,data in pairs(Player.pai_push_down) do
				local playerPos = ClickEvent.PlayerPosition(data.position)
				if playerPos == 3 then
					for paiKey,paiData in pairs(data.pai_list) do
						for valueKay,value in pairs(paiData.cards) do
							local singleChild = paiSingleList:AddItemFromPool(UIPackage.GetItemURL("MXUI","PaiSingleInList"))
							singleChild:GetChild("ChiPaiLoader01").url = UIPackage.GetItemURL("MXUI",paiData.card_type.."_"..value)
						end
					end
				end
			end

			local allFanNumber = 0
			local detailList = _popPanel[popPanelIndex].panel:GetChild("FrontPlayerClearInfo"):GetChild("FanList")
			detailList:RemoveChildrenToPool()
			local typeNumber = 0
			for countKey,countNum in pairs(v.details) do
				if countNum.fan_type ~= "FAN_TYPE_MING_GANG" and countNum.fan_type ~= "FAN_TYPE_AN_GANG" and countNum.fan_type ~= "FAN_TYPE_XUAN_FENG_GANG" then
					typeNumber = typeNumber + 1
				end
			end
			for i,c in pairs(v.details) do
				local fanName = ""
				local fanNum = 0
				for a,b in pairs(Player._calculate_table_loader) do
					for a1,b1 in pairs(b.fans) do
						if c.fan_type == b1.fan_type then
							fanName = b1.name
							fanNum = b1.multiple
							if c.fan_type ~= "FAN_TYPE_XUAN_FENG_GANG" then
								allFanNumber = allFanNumber + fanNum
							end
							break
						end
					end
				end
				if c.fan_type ~= "FAN_TYPE_MING_GANG" and c.fan_type ~= "FAN_TYPE_AN_GANG" and c.fan_type ~= "FAN_TYPE_XUAN_FENG_GANG" and c.fan_type ~= "FAN_TYPE_PINGHU" and fanNum == 0 then
					Player.LogWarning("0 fan")
				else
					if c.fan_type == "FAN_TYPE_PINGHU" and typeNumber ~= 1 then
						Player.LogWarning("many fantype")
					else
						local listChild = detailList:AddItemFromPool(_currentPanel.buttonList["ClearShowFan"])
						listChild.name = ""..i
						listChild:GetChild("FanName").text = gbk.toutf8(fanName)
						if c.fan_type == "FAN_TYPE_AN_GANG" or c.fan_type == "FAN_TYPE_MING_GANG" or c.fan_type == "FAN_TYPE_XUAN_FENG_GANG" then
							if c.score > 0 then
								listChild:GetChild("FanNum").text = "+"..tostring(c.score)
							else
								listChild:GetChild("FanNum").text = tostring(c.score)
							end
						else
							listChild:GetChild("FanNum").text = tostring(fanNum).."番"
						end
					end
				end

				--[[
				if c.score < 0 then
					listChild:GetChild("FanDou").text = ""..c.score
				else
					listChild:GetChild("FanDou").text = "+"..c.score
				end
				--]]
				--listChild:GetChild("FanPlayer").text = "+"..c.score
			end
			_popPanel[popPanelIndex].panel:GetChild("FrontPlayerClearInfo"):GetChild("TotalFanNum").text = tostring(allFanNumber)
		else
			_popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("PlayerName").text = tostring(gbk.toutf8(gbk.fromutf8(v.nickname)))
			_popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("DouNum").text = tostring(v.score)
			_popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("PlayerID").text = tostring(v.player_id)
			
			local paiList = _popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("PaiList")
			paiList:RemoveChildrenToPool()
			for i=1,Player.operation_calculate_data[0].operationNumber do
				if Player.operation_calculate_data[0][i].oper_type == "PAI_OPER_TYPE_CHIPAI" or Player.operation_calculate_data[0][i].oper_type == "PAI_OPER_TYPE_PENGPAI" or Player.operation_calculate_data[0][i].oper_type == "PAI_OPER_TYPE_XUANFENG_JIAN" then
					local listChild = paiList:AddItemFromPool(UIPackage.GetItemURL("MXUI","ChiPaiInList"))
					for j=1,3 do
						listChild:GetChild("ChiPaiLoader0"..tostring(j)).url = UIPackage.GetItemURL("MXUI",Player.operation_calculate_data[0][i].card_type.."_"..Player.operation_calculate_data[0][i].card_value[j])
					end
				else
					local listChild = paiList:AddItemFromPool(UIPackage.GetItemURL("MXUI","GangPaiInList"))
					for j=1,4 do
						listChild:GetChild("ChiPaiLoader0"..tostring(j)).url = UIPackage.GetItemURL("MXUI",Player.operation_calculate_data[0][i].card_type.."_"..Player.operation_calculate_data[0][i].card_value[j])
					end
				end
			end
			local playerHandPaiList = paiList:AddItemFromPool(UIPackage.GetItemURL("MXUI","PaiSingleList"))
			local paiSingleList = playerHandPaiList:GetChild("PaiList")
			paiSingleList:RemoveChildrenToPool()
			for dataKey,data in pairs(Player.pai_push_down) do
				local playerPos = ClickEvent.PlayerPosition(data.position)
				if playerPos == 0 then
					for paiKey,paiData in pairs(data.pai_list) do
						for valueKay,value in pairs(paiData.cards) do
							local singleChild = paiSingleList:AddItemFromPool(UIPackage.GetItemURL("MXUI","PaiSingleInList"))
							singleChild:GetChild("ChiPaiLoader01").url = UIPackage.GetItemURL("MXUI",paiData.card_type.."_"..value)
						end
					end
				end
			end

			local allFanNumber = 0
			local detailList = _popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("FanList")
			detailList:RemoveChildrenToPool()
			local typeNumber = 0
			for countKey,countNum in pairs(v.details) do
				if countNum.fan_type ~= "FAN_TYPE_MING_GANG" and countNum.fan_type ~= "FAN_TYPE_AN_GANG" and countNum.fan_type ~= "FAN_TYPE_XUAN_FENG_GANG" then
					typeNumber = typeNumber + 1
				end
			end
			for i,c in pairs(v.details) do
				local fanName = ""
				local fanNum = 0
				for a,b in pairs(Player._calculate_table_loader) do
					for a1,b1 in pairs(b.fans) do
						if c.fan_type == b1.fan_type then
							fanName = b1.name
							fanNum = b1.multiple
							if c.fan_type ~= "FAN_TYPE_XUAN_FENG_GANG" then
								allFanNumber = allFanNumber + fanNum
							end
							break
						end
					end
				end
				if c.fan_type ~= "FAN_TYPE_MING_GANG" and c.fan_type ~= "FAN_TYPE_AN_GANG" and c.fan_type ~= "FAN_TYPE_XUAN_FENG_GANG" and c.fan_type ~= "FAN_TYPE_PINGHU" and fanNum == 0 then
					Player.LogWarning("0 fan")
				else
					if c.fan_type == "FAN_TYPE_PINGHU" and typeNumber ~= 1 then
						Player.LogWarning("many fantype")
					else
						local listChild = detailList:AddItemFromPool(_currentPanel.buttonList["ClearShowFan"])
						listChild.name = ""..i
						listChild:GetChild("FanName").text = gbk.toutf8(fanName)
						if c.fan_type == "FAN_TYPE_AN_GANG" or c.fan_type == "FAN_TYPE_MING_GANG" or c.fan_type == "FAN_TYPE_XUAN_FENG_GANG" then
							if c.score > 0 then
								listChild:GetChild("FanNum").text = "+"..tostring(c.score)
							else
								listChild:GetChild("FanNum").text = tostring(c.score)
							end
						else
							listChild:GetChild("FanNum").text = tostring(fanNum).."番"
						end
					end
				end

				--[[
				if c.score < 0 then
					listChild:GetChild("FanDou").text = ""..c.score
				else
					listChild:GetChild("FanDou").text = "+"..c.score
				end
				--]]
				--listChild:GetChild("FanPlayer").text = "+"..c.score
			end
			_popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("TotalFanNum").text = tostring(allFanNumber)
		end
	end
	ClickEvent._play_ui.playerAvatarInfo:GetChild("DouNum").text = tostring(Player.playerScore[0])
	ClickEvent._play_ui.behindPlayerAvatarInfo:GetChild("DouNum").text = tostring(Player.playerScore[1])
	ClickEvent._play_ui.oppositePlayerAvatarInfo:GetChild("DouNum").text = tostring(Player.playerScore[2])
	ClickEvent._play_ui.frontPlayerAvatarInfo:GetChild("DouNum").text = tostring(Player.playerScore[3])
	for k,v in pairs(Player._all_players_data) do
		local tempX = _position_index[v.position] - _position_index[Player._my_player_data.position]
		if tempX == 1 then
			if v.wechat and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
				_popPanel[popPanelIndex].panel:GetChild("BehindPlayerClearInfo"):GetChild("AvatarLoader").url = ""
				local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
				if tempTexture then
					_popPanel[popPanelIndex].panel:GetChild("BehindPlayerClearInfo"):GetChild("AvatarLoader").texture = NTexture(tempTexture)
				end
			else
				_popPanel[popPanelIndex].panel:GetChild("BehindPlayerClearInfo"):GetChild("AvatarLoader").url = UIPackage.GetItemURL("MXUI","Touxiang01")
			end
		elseif tempX == 2 then
			if v.wechat and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
				_popPanel[popPanelIndex].panel:GetChild("OppositePlayerClearInfo"):GetChild("AvatarLoader").url = ""
				local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
				if tempTexture then
					_popPanel[popPanelIndex].panel:GetChild("OppositePlayerClearInfo"):GetChild("AvatarLoader").texture = NTexture(tempTexture)
				end
			else
				_popPanel[popPanelIndex].panel:GetChild("OppositePlayerClearInfo"):GetChild("AvatarLoader").url = UIPackage.GetItemURL("MXUI","Touxiang01")
			end
		elseif tempX == 3 then
			if v.wechat and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
				_popPanel[popPanelIndex].panel:GetChild("FrontPlayerClearInfo"):GetChild("AvatarLoader").url = ""
				local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
				if tempTexture then
					_popPanel[popPanelIndex].panel:GetChild("FrontPlayerClearInfo"):GetChild("AvatarLoader").texture = NTexture(tempTexture)
				end
			else
				_popPanel[popPanelIndex].panel:GetChild("FrontPlayerClearInfo"):GetChild("AvatarLoader").url = UIPackage.GetItemURL("MXUI","Touxiang01")
			end
		else
			if v.wechat and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
				_popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("AvatarLoader").url = ""
				local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
				if tempTexture then
					_popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("AvatarLoader").texture = NTexture(tempTexture)
				end
			else
				_popPanel[popPanelIndex].panel:GetChild("MyClearInfo"):GetChild("AvatarLoader").url = UIPackage.GetItemURL("MXUI","Touxiang01")
			end
		end
	end
end

function ClickEvent.DapaiUIShow(position,card_type,card_value)
	-- body
	local whichPlayer = ClickEvent.PlayerPosition(position)
	if whichPlayer == 1 then
		ClickEvent._play_ui.behindPaiShow:GetChild("PaiLoader").url = UIPackage.GetItemURL("MXUI",card_type.."_"..card_value)
		ClickEvent._play_ui.behindPaiShow.visible = true
	elseif whichPlayer == 2 then
		ClickEvent._play_ui.oppositePaiShow:GetChild("PaiLoader").url = UIPackage.GetItemURL("MXUI",card_type.."_"..card_value)
		ClickEvent._play_ui.oppositePaiShow.visible = true
	elseif whichPlayer == 3 then
		ClickEvent._play_ui.frontPaiShow:GetChild("PaiLoader").url = UIPackage.GetItemURL("MXUI",card_type.."_"..card_value)
		ClickEvent._play_ui.frontPaiShow.visible = true
	else
		Player.LogWarning("position nil")
	end
	AudioPlayer.PlaySound(card_type.."_"..card_value,false,1)
	AudioPlayer.PlaySound(AudioPlayer._audio_name.Dapai,false,1)
	Player.MahJong.DapaiUIHide(whichPlayer)
end

function ClickEvent.DapaiUIHide(position)
	-- body
	
	if position == 1 then
		ClickEvent._play_ui.behindPaiShow.visible = false
	elseif position == 2 then
		ClickEvent._play_ui.oppositePaiShow.visible = false
	elseif position == 3 then
		ClickEvent._play_ui.frontPaiShow.visible = false
	else
		Player.LogWarning("position nil")
	end
end

function ClickEvent.showDisconnect(content)
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(content)
end

function ClickEvent.ShowEmoji(position,chat_type,index)
	-- body
	local textureIndex = tostring(index)
	if index < 10 then
		textureIndex = "0"..tostring(index)
	end
	if chat_type == "CHAT_TYPE_TEXT" then
		AudioPlayer.PlaySound(AudioPlayer._audio_name.SayWords..tostring(index),false,1)
	end
	local whichPlayer = ClickEvent.PlayerPosition(position)
	if whichPlayer == 1 then
		ClickEvent._play_ui.behindEmoji.visible = true
		if chat_type == "CHAT_TYPE_TEXT" then
			ClickEvent._play_ui.behindEmoji:GetChild("icon").url = ""
			ClickEvent._play_ui.behindEmoji:GetChild("title").text = StringTable.Get(index+2059)
			ClickEvent._play_ui.behindEmoji:GetTransition("TextMove"):Play()
		else
			ClickEvent._play_ui.behindEmoji:GetChild("icon").url = UIPackage.GetItemURL("MXUI",textureIndex)
			ClickEvent._play_ui.behindEmoji:GetChild("title").text = ""
			ClickEvent._play_ui.behindEmoji:GetTransition("EmojiShake"):Play()
		end
		--[[
		ClickEvent._play_ui.behindEmoji:GetTransition("TextMove"):Stop(true,false)
		ClickEvent._play_ui.behindEmoji:GetTransition("EmojiShake"):Stop(true,false)
		behindTimeStamp = CS.UnityEngine.Time.time
		local co = coroutine.create(function()
	    yield_return(CS.UnityEngine.WaitForSeconds(3))
	    if CS.UnityEngine.Time.time - behindTimeStamp >= 3 then
		    ClickEvent._play_ui.behindEmoji.visible = false
	    end
		end)
		coroutine.resume(co)
		--]]
	elseif whichPlayer == 2 then
		ClickEvent._play_ui.oppositeEmoji.visible = true
		if chat_type == "CHAT_TYPE_TEXT" then
			ClickEvent._play_ui.oppositeEmoji:GetChild("icon").url = ""
			ClickEvent._play_ui.oppositeEmoji:GetChild("title").text = StringTable.Get(index+2059)
			ClickEvent._play_ui.oppositeEmoji:GetTransition("TextMove"):Play()
		else
			ClickEvent._play_ui.oppositeEmoji:GetChild("icon").url = UIPackage.GetItemURL("MXUI",textureIndex)
			ClickEvent._play_ui.oppositeEmoji:GetChild("title").text = ""
			ClickEvent._play_ui.oppositeEmoji:GetTransition("EmojiShake"):Play()
		end
		--[[
		ClickEvent._play_ui.oppositeEmoji:GetTransition("TextMove"):Stop(true,false)
		ClickEvent._play_ui.oppositeEmoji:GetTransition("EmojiShake"):Stop(true,false)
		oppositeTimeStamp = CS.UnityEngine.Time.time
		local co = coroutine.create(function()
	    yield_return(CS.UnityEngine.WaitForSeconds(3))
	    if CS.UnityEngine.Time.time - oppositeTimeStamp >= 3 then
		    ClickEvent._play_ui.oppositeEmoji.visible = false
	    end
		end)
		coroutine.resume(co)
		--]]
	elseif whichPlayer == 3 then
		ClickEvent._play_ui.FrontEmoji.visible = true
		if chat_type == "CHAT_TYPE_TEXT" then
			ClickEvent._play_ui.FrontEmoji:GetChild("icon").url = ""
			ClickEvent._play_ui.FrontEmoji:GetChild("title").text = StringTable.Get(index+2059)
			ClickEvent._play_ui.FrontEmoji:GetTransition("TextMove"):Play()
		else
			ClickEvent._play_ui.FrontEmoji:GetChild("icon").url = UIPackage.GetItemURL("MXUI",textureIndex)
			ClickEvent._play_ui.FrontEmoji:GetChild("title").text = ""
			ClickEvent._play_ui.FrontEmoji:GetTransition("EmojiShake"):Play()
		end
		--[[
		frontTimeStamp = CS.UnityEngine.Time.time
		ClickEvent._play_ui.FrontEmoji:GetTransition("TextMove"):Stop(true,false)
		ClickEvent._play_ui.FrontEmoji:GetTransition("EmojiShake"):Stop(true,false)
		local co = coroutine.create(function()
	    yield_return(CS.UnityEngine.WaitForSeconds(3))
	    if CS.UnityEngine.Time.time - frontTimeStamp >= 3 then
		    --ClickEvent._play_ui.FrontEmoji.visible = false
	    end
		end)
		coroutine.resume(co)
		--]]
	else
		ClickEvent._play_ui.playerEmoji.visible = true
		if chat_type == "CHAT_TYPE_TEXT" then
			ClickEvent._play_ui.playerEmoji:GetChild("icon").url = ""
			ClickEvent._play_ui.playerEmoji:GetChild("title").text = StringTable.Get(index+2059)
			ClickEvent._play_ui.playerEmoji:GetTransition("TextMove"):Play()
		else
			ClickEvent._play_ui.playerEmoji:GetChild("icon").url = UIPackage.GetItemURL("MXUI",textureIndex)
			ClickEvent._play_ui.playerEmoji:GetChild("title").text = ""
			ClickEvent._play_ui.playerEmoji:GetTransition("EmojiShake"):Play()
		end
		--[[
		ClickEvent._play_ui.playerEmoji:GetTransition("TextMove"):Stop(true,false)
		ClickEvent._play_ui.playerEmoji:GetTransition("EmojiShake"):Stop(true,false)
		local co = coroutine.create(function()
		playerTimeStamp = CS.UnityEngine.Time.time
	    yield_return(CS.UnityEngine.WaitForSeconds(3))
	    if CS.UnityEngine.Time.time - playerTimeStamp >= 3 then
	    	--ClickEvent._play_ui.playerEmoji.visible = false
	    end
		end)
		coroutine.resume(co)
		--]]
	end
end

function ClickEvent.IsPopPanel(name)
	-- body
	if popPanelIndex > 0 and _popPanel[popPanelIndex].panel.name == name then
		return true
	else
		return false
    end
end

function ClickEvent.ShowDissolveTime(time)
	-- body
	_popPanel[popPanelIndex].panel:GetChild("Agree"):GetChild("count").text = tostring(time)--
end

function ClickEvent.ShowDissolvePanel(data)
	-- body

	if popPanelIndex > 0 and _popPanel[popPanelIndex].panel.name == ClickEvent.panelTable._vote_ui then
	else
		Player.dismissHasClicked = false
		Player.dismissTimestarmp = CS.UnityEngine.Time.time
		ClickEvent.PopPanel(ClickEvent.panelTable._vote_ui)
		_popPanel[popPanelIndex].panel:GetChild("Agree").visible = true
		_popPanel[popPanelIndex].panel:GetChild("Disagree").visible = true
		Player.dismissIsShowing = true
		for k,v in pairs(Player._all_players_data) do
			if v.position == "POSITION_TYPE_EAST" then
				_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader1").url = UIPackage.GetItemURL("MXUI","Touxiang01")
				if v.wechat and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
					_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader1").url = ""
					local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
					if tempTexture then
						_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader1").texture = NTexture(tempTexture)
					end
				end
				_popPanel[popPanelIndex].panel:GetChild("YesOrNo1"):GetController("YesOrNo").selectedIndex = 2
			elseif v.position == "POSITION_TYPE_SOUTH" then
				_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader2").url = UIPackage.GetItemURL("MXUI","Touxiang01")
				if v.wechat and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
					_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader2").url = ""
					local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
					if tempTexture then
						_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader2").texture = NTexture(tempTexture)
					end
				end
				_popPanel[popPanelIndex].panel:GetChild("YesOrNo2"):GetController("YesOrNo").selectedIndex = 2
			elseif v.position == "POSITION_TYPE_WEST" then
				_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader3").url = UIPackage.GetItemURL("MXUI","Touxiang01")
				if v.wechat and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
					_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader3").url = ""
					local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
					if tempTexture then
						_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader3").texture = NTexture(tempTexture)
					end
				end
				_popPanel[popPanelIndex].panel:GetChild("YesOrNo3"):GetController("YesOrNo").selectedIndex = 2
			elseif v.position == "POSITION_TYPE_NORTH" then
				_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader4").url = UIPackage.GetItemURL("MXUI","Touxiang01")
				if v.wechat and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
					_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader4").url = ""
					local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
					if tempTexture then
						_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader4").texture = NTexture(tempTexture)
					end
				end
				_popPanel[popPanelIndex].panel:GetChild("YesOrNo4"):GetController("YesOrNo").selectedIndex = 2
			end
		end
	end
	local countPlayer = 0
	local firstPlayer = "POSITION_TYPE_EAST"
	for k,v in pairs(data) do
		countPlayer = countPlayer + 1
		if countPlayer == 1 then
			firstPlayer = v.position
		end
		if v.position == "POSITION_TYPE_EAST" then
			if v.oper_type == "GAME_OPER_TYPE_DISMISS_AGREE" then
				_popPanel[popPanelIndex].panel:GetChild("YesOrNo1"):GetController("YesOrNo").selectedIndex = 0
			else
				_popPanel[popPanelIndex].panel:GetChild("YesOrNo1"):GetController("YesOrNo").selectedIndex = 1
			end
		elseif v.position == "POSITION_TYPE_SOUTH" then
			if v.oper_type == "GAME_OPER_TYPE_DISMISS_AGREE" then
				_popPanel[popPanelIndex].panel:GetChild("YesOrNo2"):GetController("YesOrNo").selectedIndex = 0
			else
				_popPanel[popPanelIndex].panel:GetChild("YesOrNo2"):GetController("YesOrNo").selectedIndex = 1
			end
		elseif v.position == "POSITION_TYPE_WEST" then
			if v.oper_type == "GAME_OPER_TYPE_DISMISS_AGREE" then
				_popPanel[popPanelIndex].panel:GetChild("YesOrNo3"):GetController("YesOrNo").selectedIndex = 0
			else
				_popPanel[popPanelIndex].panel:GetChild("YesOrNo3"):GetController("YesOrNo").selectedIndex = 1
			end
		elseif v.position == "POSITION_TYPE_NORTH" then
			if v.oper_type == "GAME_OPER_TYPE_DISMISS_AGREE" then
				_popPanel[popPanelIndex].panel:GetChild("YesOrNo4"):GetController("YesOrNo").selectedIndex = 0
			else
				_popPanel[popPanelIndex].panel:GetChild("YesOrNo4"):GetController("YesOrNo").selectedIndex = 1
			end
		end
		if v.position == Player._my_player_data.position then
			_popPanel[popPanelIndex].panel:GetChild("Agree").visible = false
			_popPanel[popPanelIndex].panel:GetChild("Disagree").visible = false
		end
		if v.oper_type == "GAME_OPER_TYPE_DISMISS_DISAGREE" then
			--countDisagree = countDisagree + 1
			ClickEvent.Close()
			Player.dismissIsShowing = false
			ClickEvent.ShowToast(StringTable.Get(2011))
			return
		end
	end

	for k,v in pairs(Player._all_players_data) do
		if v.position == firstPlayer then
			if v.wechat.nickname and v.wechat.nickname ~= "" then
				_popPanel[popPanelIndex].panel:GetChild("Name").text = tostring(gbk.toutf8(gbk.fromutf8(v.wechat.nickname)))
			else
				_popPanel[popPanelIndex].panel:GetChild("Name").text = tostring(v.common_prop.name)
			end
		end
	end

	if _popPanel[popPanelIndex].panel:GetChild("YesOrNo1"):GetController("YesOrNo").selectedIndex == 0 and
	_popPanel[popPanelIndex].panel:GetChild("YesOrNo2"):GetController("YesOrNo").selectedIndex == 0 and
	_popPanel[popPanelIndex].panel:GetChild("YesOrNo3"):GetController("YesOrNo").selectedIndex == 0 and
	_popPanel[popPanelIndex].panel:GetChild("YesOrNo4"):GetController("YesOrNo").selectedIndex == 0 then
		--agree
		ClickEvent.Close()
		Player.dismissIsShowing = false
		ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
		_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(2009)
	end
end
---------------------------------------------------------------------------
-------------点击功能函数
---------------------------------------------------------------------------

function ClickEvent.BigButton( ... )
	-- body
	ClickEvent._play_ui.gameMoreControl.selectedIndex = 0
end

function ClickEvent.Agree( ... )
	-- body
	Player.CmdGameOperation("GAME_OPER_TYPE_DISMISS_AGREE")
end

function ClickEvent.Disagree( ... )
	-- body
	Player.CmdGameOperation("GAME_OPER_TYPE_DISMISS_DISAGREE")
end

function ClickEvent.GameDissolveButton(gameObject)
	-- body
	if Player.hasBeginned == false then
		if Player._my_player_data.position == "POSITION_TYPE_EAST" then
			ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
			_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(2006)
		end
		return
	end
	if not Player.dismissTimestarmp or CS.UnityEngine.Time.time - Player.dismissTimestarmp > Player.activityDataTable.room_dismiss_cooldown then
		if popPanelIndex > 0 and _popPanel[popPanelIndex].panel.name == ClickEvent.panelTable._vote_ui then
			Player.LogWarning("panelnil")
			return
		end
		Player.dismissHasClicked = false
		Player.dismissTimestarmp = CS.UnityEngine.Time.time
		ClickEvent.PopPanel(ClickEvent.panelTable._vote_ui)
		_popPanel[popPanelIndex].panel:GetChild("Agree").visible = true
		_popPanel[popPanelIndex].panel:GetChild("Disagree").visible = true
		if Player.wechat_nickname and Player.wechat_nickname ~= "" then
			_popPanel[popPanelIndex].panel:GetChild("Name").text = tostring(gbk.toutf8(gbk.fromutf8(Player.wechat_nickname)))
		else
			_popPanel[popPanelIndex].panel:GetChild("Name").text = tostring(Player._player_data.common_prop.name)
		end
		Player.dismissIsShowing = true
		for k,v in pairs(Player._all_players_data) do
			if v.position == "POSITION_TYPE_EAST" then
				_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader1").url = UIPackage.GetItemURL("MXUI","Touxiang01")
				if v.wechat and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
					_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader1").url = ""
					local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
					if tempTexture then
						_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader1").texture = NTexture(tempTexture)
					end
				end
				_popPanel[popPanelIndex].panel:GetChild("YesOrNo1"):GetController("YesOrNo").selectedIndex = 2
			elseif v.position == "POSITION_TYPE_SOUTH" then
				_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader2").url = UIPackage.GetItemURL("MXUI","Touxiang01")
				if v.wechat and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
					_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader2").url = ""
					local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
					if tempTexture then
						_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader2").texture = NTexture(tempTexture)
					end
				end
				_popPanel[popPanelIndex].panel:GetChild("YesOrNo2"):GetController("YesOrNo").selectedIndex = 2
			elseif v.position == "POSITION_TYPE_WEST" then
				_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader3").url = UIPackage.GetItemURL("MXUI","Touxiang01")
				if v.wechat and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
					_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader3").url = ""
					local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
					if tempTexture then
						_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader3").texture = NTexture(tempTexture)
					end
				end
				_popPanel[popPanelIndex].panel:GetChild("YesOrNo3"):GetController("YesOrNo").selectedIndex = 2
			elseif v.position == "POSITION_TYPE_NORTH" then
				_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader4").url = UIPackage.GetItemURL("MXUI","Touxiang01")
				if v.wechat and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
					_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader4").url = ""
					local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
					if tempTexture then
						_popPanel[popPanelIndex].panel:GetChild("PlayAvatarLoader4").texture = NTexture(tempTexture)
					end
				end
				_popPanel[popPanelIndex].panel:GetChild("YesOrNo4"):GetController("YesOrNo").selectedIndex = 2
			end
		end
		--_popPanel[popPanelIndex].panel:GetChild("Agree").visible = false
		--_popPanel[popPanelIndex].panel:GetChild("Disagree").visible = false
		Player.CmdGameOperation("GAME_OPER_TYPE_DISMISS_AGREE")
		--Player.dismissHasClicked = true
	end

end

function ClickEvent.GameInstructionButton(gameObject)
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._instruction_ui)
end

function ClickEvent.HelloText(gameObject)
	-- body
	local index = string.find(gameObject.name,"_")
	local number = string.sub(gameObject.name,index+1)
	Player.CmdSystemChat("CHAT_TYPE_TEXT",tonumber(number))
	if _currentPanel and _currentPanel.panel and _currentPanel.panel:GetChild("GameEmojiButton") then
		_currentPanel.panel:GetChild("GameEmojiButton").selected = false
	end
end

function ClickEvent.Emoji(gameObject)
	-- body
	local index = string.find(gameObject.name,"_")
	local number = string.sub(gameObject.name,index+1)
	Player.CmdSystemChat("CHAT_TYPE_FACE",tonumber(number))
	if _currentPanel and _currentPanel.panel and _currentPanel.panel:GetChild("GameEmojiButton") then
		_currentPanel.panel:GetChild("GameEmojiButton").selected = false
	end
end

function ClickEvent.InviteWechatFriends(gameObject)
	-- body
	local title = "乡乐朝阳麻将,房间号:"..tostring(Player._roomId)
	local fanxing = ""
	for k,v in pairs(Player._room_information.options.extend_type) do
		if v == "ROOM_EXTEND_TYPE_ZHANLIHU" then
			fanxing = fanxing.."站立胡"
		elseif v == "ROOM_EXTEND_TYPE_JIAHU" then
			fanxing = fanxing.."带夹胡"
		elseif v == "ROOM_EXTEND_TYPE_XUANFENGGANG" then
			fanxing = fanxing.."旋风杠"
		elseif v == "ROOM_EXTEND_TYPE_BAOPAI" then
			fanxing = fanxing.."宝牌"
		elseif v == "ROOM_EXTEND_TYPE_DUANMEN" then
			fanxing = fanxing.."可断门"
		elseif v == "ROOM_EXTEND_TYPE_QIYISE" then
			fanxing = fanxing.."清一色"
		elseif v == "ROOM_EXTEND_TYPE_BAOSANJIA" then
			fanxing = fanxing.."点炮包三家"
		end
		fanxing = fanxing.."、"
	end
	fanxing = string.sub(fanxing, 1, -2)
	local description = "局数:"..tostring(Player._room_information.options.open_rands)..fanxing
	WeChatPlatform:WXShare(title,description)
end

function ClickEvent.CopyRoomNum( ... )
	-- body
	WeChatPlatform:CopyRoomID(tostring(Player._roomId))
	ClickEvent.ShowToast(StringTable.Get(2031))
end

function ClickEvent.ChangeAccount(gameObject)
	-- body
	ClickEvent.Close()
	ClickEvent.DeletePanel(_currentPanel.panel)
	ClickEvent.CreateNewPanel(ClickEvent.panelTable._main_ui)
	os.remove(CS.UnityEngine.Application.persistentDataPath.."/openID.txt")
	Player.LogWarning(Player._string_id)
	Player.LogWarning(Player._player_data.common_prop.player_id)
	Player.CmdSwitchAccount(Player._string_id,Player._player_data.common_prop.player_id)
end

function ClickEvent.ServiveTerm1(gameObject)
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_mid)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsMidShowText"):GetChild("Text").text = StringTable.Get(3004)
end

function ClickEvent.ServiveTerm2(gameObject)
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_mid)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsMidShowText"):GetChild("Text").text = StringTable.Get(3003)
end

function ClickEvent.ServiveTerm3(gameObject)
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_mid)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsMidShowText"):GetChild("Text").text = StringTable.Get(3005)
end

function ClickEvent.ServiveTerm4(gameObject)
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_mid)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsMidShowText"):GetChild("Text").text = StringTable.Get(3006)
end

function ClickEvent.ServiveTerm5(gameObject)
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_mid)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsMidShowText"):GetChild("Text").text = StringTable.Get(3002)
end

function ClickEvent.ServiceTerm6( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_mid)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsMidShowText"):GetChild("Text").text = StringTable.Get(3001)
end

function ClickEvent.FeedBackButton(gameObject)
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(3009)
end

function ClickEvent.UpdateButton(gameObject)
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(3008)
end

function ClickEvent.CustomServiceButton(gameObject)
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(3007)
end

function ClickEvent.VipNoteList(gameObject)
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._history_score_ui)
	for k,v in pairs(Player.history_data) do
		if v.room_id == tonumber(gameObject.gameObjectName) then
			--[[
			--]]
			if v.options.model == "ROOM_MODEL_TYPE_CLASSICAL" then
				_popPanel[popPanelIndex].panel:GetChild("ModeText").text = "经典模式"
			else
				_popPanel[popPanelIndex].panel:GetChild("ModeText").text = "高番模式"
			end
			local fanxing = ""
			for k,v in pairs(v.options.extend_type) do
				if v == "ROOM_EXTEND_TYPE_ZHANLIHU" then
					fanxing = fanxing.."站立胡"
				elseif v == "ROOM_EXTEND_TYPE_JIAHU" then
					fanxing = fanxing.."带夹胡"
				elseif v == "ROOM_EXTEND_TYPE_XUANFENGGANG" then
					fanxing = fanxing.."旋风杠"
				elseif v == "ROOM_EXTEND_TYPE_BAOPAI" then
					fanxing = fanxing.."宝牌"
				elseif v == "ROOM_EXTEND_TYPE_DUANMEN" then
					fanxing = fanxing.."可断门"
				elseif v == "ROOM_EXTEND_TYPE_QIYISE" then
					fanxing = fanxing.."清一色"
				elseif v == "ROOM_EXTEND_TYPE_BAOSANJIA" then
					fanxing = fanxing.."点炮包三家"
				end
				fanxing = fanxing.."、"
			end
			fanxing = string.sub(fanxing, 1, -2)
			_popPanel[popPanelIndex].panel:GetChild("FanText").text = fanxing
			_popPanel[popPanelIndex].panel:GetChild("RoundText").text = tostring(v.options.open_rands).."局"
			if v.options.top_mutiple == 0 then
				_popPanel[popPanelIndex].panel:GetChild("MultipleText").text = "不封顶"
			else
				_popPanel[popPanelIndex].panel:GetChild("MultipleText").text = tostring(v.options.top_mutiple).."倍"
			end
			local historyList = _popPanel[popPanelIndex].panel:GetChild("HistoryList")
			historyList:RemoveChildrenToPool()
			local countScore = {}
			for i=1,4 do
				countScore[i] = {}
				countScore[i].nickname = ""
				countScore[i].headimgurl = ""
				countScore[i].allScore = 0
			end
			local roundCount = 0
			for j,c in pairs(v.list) do
				local obj = historyList:AddItemFromPool(UIPackage.GetItemURL("MXUI","VipNoteListInRound"))
				obj.name = "VipNoteListInRound"
				obj:GetChild("RoundNum").text = tostring(j)
				roundCount = roundCount + 1
				local playerNumber = 1
				for roundKey,roundData in pairs(c.list) do
					countScore[playerNumber].nickname = gbk.toutf8(gbk.fromutf8(roundData.nickname))
					countScore[playerNumber].headimgurl = roundData.headimgurl
					countScore[playerNumber].allScore = countScore[playerNumber].allScore + roundData.score
					obj:GetChild("VipNoteListRountUnit"..tostring(playerNumber)):GetChild("PlayerName").text = tostring(gbk.toutf8(gbk.fromutf8(roundData.nickname)))
					obj:GetChild("VipNoteListRountUnit"..tostring(playerNumber)):GetChild("WinLoseNum").text = tostring(roundData.score)
					obj:GetChild("VipNoteListRountUnit"..tostring(playerNumber)):GetChild("AvatarLoader").url  = UIPackage.GetItemURL("MXUI","Touxiang01")
					if roundData.headimgurl and roundData.headimgurl ~= "" then
						obj:GetChild("VipNoteListRountUnit"..tostring(playerNumber)):GetChild("AvatarLoader").url = ""
						local tempTexture = WeChatPlatform:SetAsyncImage(roundData.headimgurl)
						if tempTexture then
							obj:GetChild("VipNoteListRountUnit"..tostring(playerNumber)):GetChild("AvatarLoader").texture = NTexture(tempTexture)
						end
					end
					playerNumber = playerNumber + 1
				end
			end
			local historyShareList = _popPanel[popPanelIndex].panel:GetChild("HistoryShareList")
			historyShareList:RemoveChildrenToPool()
			for i=1,4 do
				local tempTable = {}
				for j=i,4 do
					if countScore[i].allScore < countScore[j].allScore then
						tempTable = countScore[i]
						countScore[i] = countScore[j]
						countScore[j] = tempTable
					end
				end
			end
			for i=1,4 do
				local obj = historyShareList:AddItemFromPool(UIPackage.GetItemURL("MXUI","VipNoteListInTotal"))
				obj.name = "VipNoteListInTotal"
				obj:GetChild("Rank").text = tostring(i)
				if countScore[i].allScore < 0 then
					local loseFont = obj:GetChild("VipNoteListTotalUnit"):GetChild("WinLoseNum").textFormat
					loseFont.font = UIPackage.GetItemURL("MXUI","LoseFont")
					obj:GetChild("VipNoteListTotalUnit"):GetChild("WinLoseNum").textFormat = loseFont
					obj:GetChild("VipNoteListTotalUnit"):GetChild("WinLoseNum").text = tostring(countScore[i].allScore)
				else
					local winFont = obj:GetChild("VipNoteListTotalUnit"):GetChild("WinLoseNum").textFormat
					winFont.font = UIPackage.GetItemURL("MXUI","WinFont")
					obj:GetChild("VipNoteListTotalUnit"):GetChild("WinLoseNum").textFormat = winFont
					obj:GetChild("VipNoteListTotalUnit"):GetChild("WinLoseNum").text = tostring(countScore[i].allScore)
				end
				obj:GetChild("VipNoteListTotalUnit"):GetChild("PlayerName").text = tostring(countScore[i].nickname)
				obj:GetChild("VipNoteListTotalUnit"):GetChild("AvatarLoader").url  = UIPackage.GetItemURL("MXUI","Touxiang01")
				if countScore[i].headimgurl and countScore[i].headimgurl ~= "" then
					obj:GetChild("VipNoteListTotalUnit"):GetChild("AvatarLoader").url = ""
					local tempTexture = WeChatPlatform:SetAsyncImage(countScore[i].headimgurl)
					if tempTexture then
						obj:GetChild("VipNoteListTotalUnit"):GetChild("AvatarLoader").texture = NTexture(tempTexture)
					end
				end
				obj:GetChild("VipNoteListTotalUnit"):GetChild("TotalRoundNum").text = tostring(roundCount)
			end
			--[[
			--]]
		end
	end
	
end

function ClickEvent.GameSettingButton( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._setting_ui)
	Player.LogWarning("Music:")
	Player.LogWarning(Player._player_data.game_setting.music)
	if Player.wechat_nickname and Player.wechat_nickname ~= "" then
		_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("PlayerName").text = tostring(gbk.toutf8(gbk.fromutf8(Player.wechat_nickname)))
	else
		_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("PlayerName").text = Player._player_data.common_prop.name
	end
	_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("PlayerID").text = tostring(Player._player_data.common_prop.player_id)
	if Player.wechat_headimgurl and Player.wechat_headimgurl ~= "" then
		_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").url = ""
		local tempTexture = WeChatPlatform:SetAsyncImage(Player.wechat_headimgurl)
		--[[
		WeChatPlatform.func = function ()
			-- body
			local delegateTex = WeChatPlatform:SetAsyncImage(headimgurl)
			if delegateTex then
				_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").texture = NTexture(delegateTex)
			end
		end
		--]]
		_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").texture = NTexture(tempTexture)
	end
	_popPanel[popPanelIndex].panel:GetChild("MusicSlideButton").selected = Player._player_data.game_setting.music
	_popPanel[popPanelIndex].panel:GetChild("EffectSlideButton").selected = Player._player_data.game_setting.audio
	_popPanel[popPanelIndex].panel:GetChild("GameVoiceSlideButton").selected = Player._player_data.game_setting.voice
	_popPanel[popPanelIndex].panel:GetChild("ClickOutSlideButton").selected = Player._player_data.game_setting.click_push
	_popPanel[popPanelIndex].panel:GetChild("ChangeAccount").visible = false
end

function ClickEvent.MusicSlideButton( ... )
	-- body
	Player._player_data.game_setting.music = _popPanel[popPanelIndex].panel:GetChild("MusicSlideButton").selected
	if Player._player_data.game_setting.music then
		AudioPlayer.PlaySound(AudioPlayer._audio_name.Bgm,true,0.5)
	else
		AudioPlayer.StopSound(AudioPlayer._audio_name.Bgm)
	end
end

function ClickEvent.EffectSlideButton( ... )
	-- body
	Player._player_data.game_setting.audio = _popPanel[popPanelIndex].panel:GetChild("EffectSlideButton").selected
end

function ClickEvent.GameVoiceSlideButton( ... )
	-- body
	Player._player_data.game_setting.voice = _popPanel[popPanelIndex].panel:GetChild("GameVoiceSlideButton").selected
end

function ClickEvent.ClickOutSlideButton( ... )
	-- body
	Player._player_data.game_setting.click_push = _popPanel[popPanelIndex].panel:GetChild("ClickOutSlideButton").selected
end

function ClickEvent.Shop( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._mall_ui)
	_popPanel[popPanelIndex].panel:GetChild("MallDouButton").selected = true
end

function ClickEvent.Instruction( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._instruction_ui)
end

function ClickEvent.Mail( ... )
	-- body
	Player.LogWarning("mail")
	ClickEvent.PopPanel(ClickEvent.panelTable._mail_ui)
end

function ClickEvent.VIPRecordButton( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._vip_note_ui)
	_popPanel[popPanelIndex].panel:GetChild("NoteList"):RemoveChildrenToPool()
	_popPanel[popPanelIndex].panel:GetChild("NoteList").scrollPane.onPullUpRelease:Add(ClickEvent.OnPullUpRefresh)
	local dataCount = 0
	for k,v in pairs(Player.history_data) do
		dataCount = dataCount + 1
		local obj = _popPanel[popPanelIndex].panel:GetChild("NoteList"):AddItemFromPool(UIPackage.GetItemURL("MXUI","VipNoteList"))
		obj.name = "VipNoteList"
		obj.gameObjectName = tostring(v.room_id)
		obj.onClick:Add(ClickEvent.registerButtonClick)
		local year,month,day = ClickEvent.ChangeSecondToDate(v.create_time)
		local hour,minute = ClickEvent.ChangeSecondToTime(v.create_time)
		obj:GetChild("FinishDate").text = tostring(year).."/"..tostring(month).."/"..tostring(day)
		obj:GetChild("FinishTime").text = tostring(hour)..":"..tostring(minute)
		local countScore = 0
		local headimgurlTable = {}
		local imgCount = 0
		for j,c in pairs(v.list) do
			imgCount = 0
			for roundKey,roundData in pairs(c.list) do
				imgCount = imgCount + 1
				if not headimgurlTable[imgCount] then
					headimgurlTable[imgCount] = roundData.headimgurl
				end
				if roundData.player_id == Player._player_data.common_prop.player_id then
					countScore = countScore + roundData.score
				end
			end
		end
		for i=1,4 do
			local tempTexture = WeChatPlatform:SetAsyncImage(headimgurlTable[i])
			if tempTexture then
				obj:GetChild("Avatar"..tostring(i)).texture = NTexture(tempTexture)
			end
		end
		WeChatPlatform:SetFuncDelegate(function ( ... )
			-- body
			for i=1,4 do
				local tempTexture = WeChatPlatform:SetAsyncImage(headimgurlTable[i])
				if tempTexture then
					obj:GetChild("Avatar"..tostring(i)).texture = NTexture(tempTexture)
				end
			end
		end)
		if countScore > 0 then
			obj:GetChild("WinLoseNum").text = "+"..tostring(countScore)
		else
			obj:GetChild("WinLoseNum").text = tostring(countScore)
		end
	end
	Player.history_start = dataCount + 1
	if dataCount <= 5 and dataCount < Player.history_count then
		ClickEvent.OnPullUpRefresh()
	end
end

function ClickEvent.OnReceiveHistory()
	-- body
	if ClickEvent.IsPopPanel(ClickEvent.panelTable._vip_note_ui) == true then
		local dataCount = 0
		for i=Player.history_start,Player.history_end do
			local v = Player.history_data[i]
			Player.LogWarning("currentDataIndex:"..i)
			dataCount = dataCount + 1
			local obj = _popPanel[popPanelIndex].panel:GetChild("NoteList"):AddItemFromPool(UIPackage.GetItemURL("MXUI","VipNoteList"))
			obj.name = "VipNoteList"
			obj.gameObjectName = tostring(v.room_id)
			obj.onClick:Add(ClickEvent.registerButtonClick)
			local year,month,day = ClickEvent.ChangeSecondToDate(v.create_time)
			local hour,minute = ClickEvent.ChangeSecondToTime(v.create_time)
			obj:GetChild("FinishDate").text = tostring(year).."/"..tostring(month).."/"..tostring(day)
			obj:GetChild("FinishTime").text = tostring(hour)..":"..tostring(minute)
			local countScore = 0
			local headimgurlTable = {}
			local imgCount = 0
			for j,c in pairs(v.list) do
				imgCount = 0
				for roundKey,roundData in pairs(c.list) do
					imgCount = imgCount + 1
					if not headimgurlTable[imgCount] then
						headimgurlTable[imgCount] = roundData.headimgurl
					end
					if roundData.player_id == Player._player_data.common_prop.player_id then
						countScore = countScore + roundData.score
					end
				end
			end
			for i=1,4 do
				local tempTexture = WeChatPlatform:SetAsyncImage(headimgurlTable[i])
				if tempTexture then
					obj:GetChild("Avatar"..tostring(i)).texture = NTexture(tempTexture)
				end
			end
			if countScore > 0 then
				obj:GetChild("WinLoseNum").text = "+"..tostring(countScore)
			else
				obj:GetChild("WinLoseNum").text = tostring(countScore)
			end
		end
		Player.history_start = dataCount + Player.history_start
	end
end

function ClickEvent.OnPullUpRefresh()
	-- body
	Player.LogWarning("OnPullUpRefresh:"..Player.history_start)
	Player.history_end = Player.history_start
	if Player.history_end <= Player.history_count then
		if Player.history_end + 4 <= Player.history_count then
			Player.history_end = Player.history_end + 4
			Player.CmdBattleHistory(Player.history_start,Player.history_end)
		else
			Player.history_end = Player.history_count
			Player.CmdBattleHistory(Player.history_start,Player.history_end)
		end
	end
	Player.LogWarning("refreshStart:"..Player.history_start.."refreshEnd:"..Player.history_end)
end

function ClickEvent.ChangeSecondToDate(t)
	-- body
	return os.date("%Y",t),os.date("%m",t),os.date("%d",t)
end

function ClickEvent.ChangeSecondToTime(t)
	-- body
	return os.date("%H",t),os.date("%M",t)
end

function ClickEvent.Promotion( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._activity_ui)
	_popPanel[popPanelIndex].panel:GetChild("UnlimitedRoomCardButton").visible = false
end

function ClickEvent.Welfare( ... )
	-- body
	--ClickEvent.PopPanel(ClickEvent.panelTable._welfare_ui)
	ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(3000)
end

function ClickEvent.Setting( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._setting_ui)
	Player.LogWarning("Music:")
	Player.LogWarning(Player._player_data.game_setting.music)
	_popPanel[popPanelIndex].panel:GetChild("Version").text = Player.pc_version
	if Player.wechat_nickname and Player.wechat_nickname ~= "" then
		_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("PlayerName").text = gbk.toutf8(gbk.fromutf8(Player.wechat_nickname))
	else
		_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("PlayerName").text = Player._player_data.common_prop.name
	end
	_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("PlayerID").text = tostring(Player._player_data.common_prop.player_id)
	if Player.wechat_headimgurl and Player.wechat_headimgurl ~= "" then
		_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").url = ""
		local tempTexture = WeChatPlatform:SetAsyncImage(Player.wechat_headimgurl)
		--[[
		WeChatPlatform.func = function ()
			-- body
			local delegateTex = WeChatPlatform:SetAsyncImage(Player.wechat_headimgurl)
			if delegateTex then
				_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").texture = NTexture(delegateTex)
			end
		end
		--]]
		_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").texture = NTexture(tempTexture)
	end
	_popPanel[popPanelIndex].panel:GetChild("MusicSlideButton").selected = Player._player_data.game_setting.music
	_popPanel[popPanelIndex].panel:GetChild("EffectSlideButton").selected = Player._player_data.game_setting.audio
	_popPanel[popPanelIndex].panel:GetChild("GameVoiceSlideButton").selected = Player._player_data.game_setting.voice
	_popPanel[popPanelIndex].panel:GetChild("ClickOutSlideButton").selected = Player._player_data.game_setting.click_push
end

function ClickEvent.More( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(3000)
end

function ClickEvent.RoomCardNum( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._mall_ui)
	_popPanel[popPanelIndex].panel:GetChild("MallItemButton").selected = true
end

function ClickEvent.DouNum( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._mall_ui)
	_popPanel[popPanelIndex].panel:GetChild("MallDouButton").selected = true
end

function ClickEvent.GemsNum( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._mall_ui)
	_popPanel[popPanelIndex].panel:GetChild("MallGemsButton").selected = true
end

function ClickEvent.PriceButtonGems1( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(2027)
end
function ClickEvent.PriceButtonGems2( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(2027)
end
function ClickEvent.PriceButtonGems3( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(2027)
end
function ClickEvent.PriceButtonGems4( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(2027)
end
function ClickEvent.PriceButtonGems5( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(2027)
end
function ClickEvent.PriceButtonGems6( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(2027)
end

function ClickEvent.PriceButtonDou1( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(2027)
end
function ClickEvent.PriceButtonDou2( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(2027)
end
function ClickEvent.PriceButtonDou3( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(2027)
end
function ClickEvent.PriceButtonDou4( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(2027)
end
function ClickEvent.PriceButtonDou5( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(2027)
end
function ClickEvent.PriceButtonDou6( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(2027)
end

function ClickEvent.PriceButtonItem1( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(2027)
end
function ClickEvent.PriceButtonItem2( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
	_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(2027)
end

function ClickEvent.Avatar( ... )
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._player_info)
	if Player.wechat_nickname and Player.wechat_nickname ~= "" then
		_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("PlayerName").text = gbk.toutf8(gbk.fromutf8(Player.wechat_nickname))
		_popPanel[popPanelIndex].panel:GetChild("BoundAccount").visible = false
	else
		_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("PlayerName").text = Player._player_data.common_prop.name
	end
	_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("PlayerID").text = tostring(Player._player_data.common_prop.player_id)
	if Player.wechat_headimgurl and Player.wechat_headimgurl ~= "" then
		_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").url = ""
		local tempTexture = WeChatPlatform:SetAsyncImage(Player.wechat_headimgurl)
		--[[
		WeChatPlatform.func = function ()
			-- body
			local delegateTex = WeChatPlatform:SetAsyncImage(Player.wechat_headimgurl)
			if delegateTex then
				_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").texture = NTexture(delegateTex)
			end
		end
		--]]
		_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").texture = NTexture(tempTexture)
	end
	_popPanel[popPanelIndex].panel:GetChild("DouNum").text = tostring(Player._player_data.common_prop.huanledou)
	_popPanel[popPanelIndex].panel:GetChild("RoomCardPlay").text = tostring(Player._player_data.common_prop.room_card_count)
	_popPanel[popPanelIndex].panel:GetChild("TotalWin").text = tostring(Player._player_data.common_prop.streak_wins)
	_popPanel[popPanelIndex].panel:GetChild("TotalPlay").text = tostring(Player._player_data.common_prop.total_rounds)
	if Player._player_data.common_prop.total_rounds == 0 then
		_popPanel[popPanelIndex].panel:GetChild("WinRate").text = "0"
	else
		_popPanel[popPanelIndex].panel:GetChild("WinRate").text = tostring(math.modf(Player._player_data.common_prop.total_win_rounds*100/Player._player_data.common_prop.total_rounds)).."%"
	end
end

function ClickEvent.NextRoundButton( ... )
	-- body
	ClickEvent.Close()
	_currentPanel.panel:GetChild("BaoPai"):GetController("BaoPaiShow").selectedIndex = 0
	Player.MahJong.ResetGameState()
	ClickEvent.ShowRoomCalculate()
	--if Player._calculate_table_number >= Player._room_information.options.open_rands then
	--end
end

function ClickEvent.NoButton( ... )
	-- body
	if _popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText") and _popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text == StringTable.Get(2009) then
		Player.CmdGameOperation("GAME_OPER_TYPE_LEAVE")
	end
	ClickEvent.Close()
end

function ClickEvent.YesButton( ... )
	-- body
	if _popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText") and _popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text == StringTable.Get(2003) then
		if Player.hasBeginned == false then
			--Player.returnMainUI = true
			--Player.MahJong.QuitVoiceRoom()
			Player.CmdGameOperation("GAME_OPER_TYPE_LEAVE")
			--Player.LoadScene("FairyMainUI")
		end
	elseif _popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText") and _popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text == StringTable.Get(2002) then
		CS.UnityEngine.Application.Quit()
	elseif _popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText") and _popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text == StringTable.Get(2006) then
		Player.CmdGameOperation("GAME_OPER_TYPE_DISMISS_AGREE")
	elseif _popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText") and _popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text == StringTable.Get(2009) then
		Player.CmdGameOperation("GAME_OPER_TYPE_LEAVE")
	elseif _popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText") and _popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text == StringTable.Get(2036) then
		Player._roomId = Player._player_data.room_id
		Player.LogWarning(tonumber(Player._roomId))
		Player.isFriendRoom = true
		Player.CmdEnterRoom("ROOM_TYPE_FRIEND",Player._roomId)
	end
	ClickEvent.Close()
end

function ClickEvent.PlayerAvatarInfo( ... )
	-- body
	if not Player._my_player_data then
		return
	end
	ClickEvent.PopPanel(ClickEvent.panelTable._player_info)
	_popPanel[popPanelIndex].panel:RemoveChild(_popPanel[popPanelIndex].panel:GetChild("BoundAccount"))

	for k,v in pairs(Player._all_players_data) do
		local tempX = _position_index[v.position] - _position_index[Player._my_player_data.position]
		if tempX == 0 then
			_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("PlayerID").text = tostring(v.common_prop.player_id)
			if Player.wechat_nickname and Player.wechat_nickname ~= "" then
				_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("PlayerName").text = gbk.toutf8(gbk.fromutf8(Player.wechat_nickname))
			else
				_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("PlayerName").text = tostring(v.common_prop.name)
			end
			_popPanel[popPanelIndex].panel:GetChild("DouNum").text = tostring(v.common_prop.huanledou)
			--_popPanel[popPanelIndex].panel:GetChild("GemsNum").text = tostring(v.common_prop.diamond)
			_popPanel[popPanelIndex].panel:GetChild("TotalWin").text = tostring(v.common_prop.streak_wins)
			_popPanel[popPanelIndex].panel:GetChild("TotalPlay").text = tostring(v.common_prop.total_rounds)
			_popPanel[popPanelIndex].panel:GetChild("RoomCardPlay").text = tostring(v.common_prop.room_card_count)
			if v.common_prop.total_rounds == 0 then
				_popPanel[popPanelIndex].panel:GetChild("WinRate").text = "0"
			else
				_popPanel[popPanelIndex].panel:GetChild("WinRate").text = math.modf(v.common_prop.total_win_rounds*100/v.common_prop.total_rounds).."%"
			end
			if v.wechat ~= {} and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
				_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").url = ""
				local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
				if tempTexture then
					_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").texture = NTexture(tempTexture)
				end
			end
			return
		end
	end
	ClickEvent.Close()
end

function ClickEvent.BehindPlayerAvatarInfo( ... )
	-- body
	if not Player._my_player_data then
		return
	end
	ClickEvent.PopPanel(ClickEvent.panelTable._other_player_info)
	if Player._my_player_data.position ~= "POSITION_TYPE_EAST" then
		_popPanel[popPanelIndex].panel:RemoveChild(_popPanel[popPanelIndex].panel:GetChild("KickOutRoomButton"))
	end
	for k,v in pairs(Player._all_players_data) do
		local tempX = _position_index[v.position] - _position_index[Player._my_player_data.position]
		if tempX == 1 then
			_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("PlayerID").text = tostring(v.common_prop.player_id)
			if v.wechat ~= {} and v.wechat.nickname and v.wechat.nickname ~= "" then
				_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("PlayerName").text = tostring(gbk.toutf8(gbk.fromutf8(v.wechat.nickname)))
			else
				_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("PlayerName").text = tostring(v.common_prop.name)
			end
			_popPanel[popPanelIndex].panel:GetChild("DouNum").text = tostring(v.common_prop.huanledou)
			_popPanel[popPanelIndex].panel:GetChild("TotalWin").text = tostring(v.common_prop.streak_wins)
			_popPanel[popPanelIndex].panel:GetChild("TotalPlay").text = tostring(v.common_prop.total_rounds)
			_popPanel[popPanelIndex].panel:GetChild("RoomCardPlay").text = tostring(v.common_prop.room_card_count)
			if v.common_prop.total_rounds == 0 then
				_popPanel[popPanelIndex].panel:GetChild("WinRate").text = "0"
			else
				_popPanel[popPanelIndex].panel:GetChild("WinRate").text = math.modf(v.common_prop.total_win_rounds*100/v.common_prop.total_rounds).."%"
			end
			_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").url = UIPackage.GetItemURL("MXUI","Touxiang01")
			if v.wechat ~= {} and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
				_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").url = ""
				local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
				--[[
				WeChatPlatform.func = nil
				WeChatPlatform.func = function ()
					-- body
					local delegateTex = WeChatPlatform:SetAsyncImage(v.wechat_headimgurl)
					if delegateTex then
						_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").texture = NTexture(delegateTex)
					end
				end
				--]]
				if tempTexture then
					_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").texture = NTexture(tempTexture)
				end
			end
			_popPanel[popPanelIndex].panel:GetChild("n64").text = "GPS未开启"
			for gpsKey,gpsData in pairs(v.dis_list) do
				if Player._my_player_data.position == gpsData.position then
					if gpsData.distance ~= -1.0 then
						_popPanel[popPanelIndex].panel:GetChild("n64").text = tostring(math.ceil(gpsData.distance)).."m"
					end
				end
			end
			return
		end
	end
	ClickEvent.Close()
end

function ClickEvent.OppositePlayerAvatarInfo( ... )
	-- body
	if not Player._my_player_data then
		return
	end
	ClickEvent.PopPanel(ClickEvent.panelTable._other_player_info)
	if Player._my_player_data.position ~= "POSITION_TYPE_EAST" then
		_popPanel[popPanelIndex].panel:RemoveChild(_popPanel[popPanelIndex].panel:GetChild("KickOutRoomButton"))
	end
	for k,v in pairs(Player._all_players_data) do
		local tempX = _position_index[v.position] - _position_index[Player._my_player_data.position]
		if tempX == 2 then
			_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("PlayerID").text = tostring(v.common_prop.player_id)
			if v.wechat ~= {} and v.wechat.nickname and v.wechat.nickname ~= "" then
				_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("PlayerName").text = tostring(gbk.toutf8(gbk.fromutf8(v.wechat.nickname)))
			else
				_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("PlayerName").text = tostring(v.common_prop.name)
			end
			_popPanel[popPanelIndex].panel:GetChild("DouNum").text = tostring(v.common_prop.huanledou)
			_popPanel[popPanelIndex].panel:GetChild("TotalWin").text = tostring(v.common_prop.streak_wins)
			_popPanel[popPanelIndex].panel:GetChild("TotalPlay").text = tostring(v.common_prop.total_rounds)
			_popPanel[popPanelIndex].panel:GetChild("RoomCardPlay").text = tostring(v.common_prop.room_card_count)
			if v.common_prop.total_rounds == 0 then
				_popPanel[popPanelIndex].panel:GetChild("WinRate").text = "0"
			else
				_popPanel[popPanelIndex].panel:GetChild("WinRate").text = math.modf(v.common_prop.total_win_rounds*100/v.common_prop.total_rounds).."%"
			end
			_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").url = UIPackage.GetItemURL("MXUI","Touxiang01")
			if v.wechat ~= {} and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
				_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").url = ""
				local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
				--[[
				WeChatPlatform.func = nil
				WeChatPlatform.func = function ()
					-- body
					local delegateTex = WeChatPlatform:SetAsyncImage(v.wechat_headimgurl)
					if delegateTex then
						_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").texture = NTexture(delegateTex)
					end
				end
				--]]
				if tempTexture then
					_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").texture = NTexture(tempTexture)
				end
			end
			_popPanel[popPanelIndex].panel:GetChild("n64").text = "GPS未开启"
			for gpsKey,gpsData in pairs(v.dis_list) do
				if Player._my_player_data.position == gpsData.position then
					if gpsData.distance ~= -1.0 then
						_popPanel[popPanelIndex].panel:GetChild("n64").text = tostring(math.ceil(gpsData.distance)).."m"
					end
				end
			end
			return
		end
	end
	ClickEvent.Close()
end

function ClickEvent.FrontPlayerAvatarInfo( ... )
	-- body
	if not Player._my_player_data then
		return
	end
	ClickEvent.PopPanel(ClickEvent.panelTable._other_player_info)
	if Player._my_player_data.position ~= "POSITION_TYPE_EAST" then
		_popPanel[popPanelIndex].panel:RemoveChild(_popPanel[popPanelIndex].panel:GetChild("KickOutRoomButton"))
	end
	for k,v in pairs(Player._all_players_data) do
		local tempX = _position_index[v.position] - _position_index[Player._my_player_data.position]
		if tempX == 3 then
			_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("PlayerID").text = tostring(v.common_prop.player_id)
			if v.wechat ~= {} and v.wechat.nickname and v.wechat.nickname ~= "" then
				_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("PlayerName").text = tostring(gbk.toutf8(gbk.fromutf8(v.wechat.nickname)))
			else
				_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("PlayerName").text = tostring(v.common_prop.name)
			end
			_popPanel[popPanelIndex].panel:GetChild("DouNum").text = tostring(v.common_prop.huanledou)
			_popPanel[popPanelIndex].panel:GetChild("TotalWin").text = tostring(v.common_prop.streak_wins)
			_popPanel[popPanelIndex].panel:GetChild("TotalPlay").text = tostring(v.common_prop.total_rounds)
			_popPanel[popPanelIndex].panel:GetChild("RoomCardPlay").text = tostring(v.common_prop.room_card_count)
			if v.common_prop.total_rounds == 0 then
				_popPanel[popPanelIndex].panel:GetChild("WinRate").text = "0"
			else
				_popPanel[popPanelIndex].panel:GetChild("WinRate").text = math.modf(v.common_prop.total_win_rounds*100/v.common_prop.total_rounds).."%"
			end
			_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").url = UIPackage.GetItemURL("MXUI","Touxiang01")
			if v.wechat ~= {} and v.wechat.headimgurl and v.wechat.headimgurl ~= "" then
				_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").url = ""
				local tempTexture = WeChatPlatform:SetAsyncImage(v.wechat.headimgurl)
				--[[
				WeChatPlatform.func = nil
				WeChatPlatform.func = function ()
					-- body
					local delegateTex = WeChatPlatform:SetAsyncImage(v.wechat_headimgurl)
					if delegateTex then
						_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").texture = NTexture(delegateTex)
					end
				end
				--]]
				if tempTexture then
					_popPanel[popPanelIndex].panel:GetChild("PlayerInformation"):GetChild("AvatarLoader").texture = NTexture(tempTexture)
				end
			end
			_popPanel[popPanelIndex].panel:GetChild("n64").text = "GPS未开启"
			for gpsKey,gpsData in pairs(v.dis_list) do
				if Player._my_player_data.position == gpsData.position then
					if gpsData.distance ~= -1.0 then
						_popPanel[popPanelIndex].panel:GetChild("n64").text = tostring(math.ceil(gpsData.distance)).."m"
					end
				end
			end
			return
		end
	end
	ClickEvent.Close()
end

function ClickEvent.PlayerID( gameObject )
	-- body
	Player._string_id = gameObject:GetComponent("InputField").text
end

function ClickEvent.PlayerPassword( gameObject )
	-- body
	Player._password = gameObject:GetComponent("InputField").text
end

function ClickEvent.LoginButton(gameObject)
	-- body
	--[[
	--]]
	local textShow = _currentPanel.panel:GetChild("Account"):GetChild("InputText")
	Player._string_id = textShow.text
	Player.CmdLogin(Player._string_id,nil,"ACCOUNT_TYPE_8HERE")

end
function ClickEvent.Account( gameObject )
	-- body
	Player.LogWarning(gameObject.name)
end

function ClickEvent.GuestLogin( gameObject )
	-- body
	--[[
	if _currentPanel.toggleList and _currentPanel.toggleList[0].isOn then
		ClickEvent.DestroyPanel(_currentPanel.panel)
		ClickEvent.CreateNewPanel(ClickEvent.panelTable._choose_ui)
	else
		Player.LogWarning("no find toggle")
	end
	Player.CmdEnterGame(Player._id)
	--]]
	if not Player.coolDown then
		Player.coolDown = CS.UnityEngine.Time.time
	else
		if (CS.UnityEngine.Time.time - Player.coolDown) <= Player.connectTimes then
			return
		else
			Player.coolDown = CS.UnityEngine.Time.time
		end
	end

	local path = CS.UnityEngine.Application.persistentDataPath.."/"
	local openIdFile = io.open(path.."guestID.txt")
	if not openIdFile then
		Player._string_id = ""
		Player.CmdGuestLogin()
	else
		Player._string_id = openIdFile:read "*a"
        openIdFile:close()
        Player.CmdLogin(Player._string_id,nil,"ACCOUNT_TYPE_GUEST")
	end
	Player.LogWarning("ClickEvent.GuestLogin")
end

function ClickEvent.WechatLogin(gameObject)
	-- body
	if not Player.coolDown then
		Player.coolDown = CS.UnityEngine.Time.time
	else
		if (CS.UnityEngine.Time.time - Player.coolDown) <= Player.connectTimes then
			return
		else
			Player.coolDown = CS.UnityEngine.Time.time
		end
	end

	Player.LogWarning("ClickEvent.WechatLogin")
	local path = CS.UnityEngine.Application.persistentDataPath.."/"
	--[[
	Player._string_id = WeChatPlatform:GetData("getOpenID")
	Player.wechat_nickname = WeChatPlatform:GetData("getNickName")
	Player.LogWarning(Player._string_id)
		Player.wechat_sex = WeChatPlatform:GetData("getUserSex")
		Player.wechat_headimgurl = WeChatPlatform:GetData("getImageUrl")
		WeChatPlatform:SetAsyncImage(WeChatPlatform:GetData("getImageUrl"))
		Player.CmdLogin(Player._string_id)
		Player.LogWarning("WeChatLogin")
	--]]
	local openIdFile = io.open(path.."openID.txt")
	if not openIdFile then
		Player._string_id = ""
	else
		Player._string_id = openIdFile:read "*a"
        openIdFile:close()
	end
	--Player.wechat_code = WeChatPlatform:GetData("getWXCode")
	Player.LogWarning(Player._string_id)
	if not Player._string_id or Player._string_id == "" then
		if not Player.wechat_code or Player.wechat_code == "" then
			WeChatPlatform.onWeChatCallBack = function(paraCode)
				-- body
				Player.wechat_code = paraCode--WeChatPlatform:GetData("getWXCode")
				Player.CmdWechatLogin(Player.wechat_code)
				WeChatPlatform.onWeChatCallBack = nil
				if not Player.coolDown then
					Player.coolDown = CS.UnityEngine.Time.time
				else
					if Player.coolDown - CS.UnityEngine.Time.time <= Player.connectTimes then
						return
					else
						Player.coolDown = CS.UnityEngine.Time.time
					end
				end
			end
			WeChatPlatform:LoginWeChat()
		else
			Player.LogWarning("getWXMsg")
			Player.CmdWechatLogin(Player.wechat_code)
		end
	else
		Player.CmdLogin(Player._string_id,nil,"ACCOUNT_TYPE_WECHAT")
	end
end

function ClickEvent.OnReceivedWeChatMsg(nickname, sex, headimgurl)
	-- body
	Player.wechat_nickname = nickname
	Player.wechat_sex = sex
	Player.wechat_headimgurl = headimgurl
	Player.LogWarning(Player.wechat_nickname)
	Player.LogWarning(player.wechat_sex)
	Player.LogWarning(player.wechat_headimgurl)
end

function ClickEvent.ThreadToMainMenu( ... )
	-- body
	ClickEvent.DeletePanel(_currentPanel.panel)
	ClickEvent.CreateNewPanel(ClickEvent.panelTable._choose_ui)
	if Player._player_data.game_setting.music and not AudioPlayer.isPlaying(AudioPlayer._audio_name.Bgm) then
		AudioPlayer.PlaySound(AudioPlayer._audio_name.Bgm,true,0.5)
	end
end

function ClickEvent.Admit( gameObject )
	-- body
end

function ClickEvent.Back( ... )
	-- body
	if not ClickEvent.isInDouRoom and _currentPanel.panel.name == ClickEvent.panelTable._choose_ui then
		ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
		_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(2002)
		--_currentPanel.panel:GetTransition("ShowFriendMode"):Stop(true,false)
		--ClickEvent.DeletePanel(_currentPanel.panel)
		--ClickEvent.CreateNewPanel(ClickEvent.panelTable._main_ui)
	else
		ClickEvent.isInDouRoom = false
		_currentPanel.panel:GetTransition("ShowFriendMode"):Play()
	end
end

function ClickEvent.PlayerLogo( ... )
	-- body
	Player.LogWarning("playLogoShow")
	ClickEvent.PopPanel(ClickEvent.panelTable._player_message_ui)
	--_Player_Message_UI:SetActive(true)
end

function ClickEvent.DiamondPlus( ... )
	-- body
	Player.LogWarning("DiamondPlusShow")
end

function ClickEvent.BeanPlus( ... )
	-- body
	Player.LogWarning("BeanPlusShow")
end

function ClickEvent.TicketPlus( ... )
	-- body
	Player.LogWarning("TicketPlusShow")
end

function ClickEvent.DouRoomButton( ... )
	-- body
	if _currentPanel.panel:GetTransition("HideFriendMode").playing then
		return
	end
	_currentPanel.panel:GetTransition("HideFriendMode"):Play()
	ClickEvent.isInDouRoom = true
end

function ClickEvent.GetintoRoomButton( ... )
	-- body
	Player.LogWarning("JoinRoom")
	ClickEvent.PopPanel(ClickEvent.panelTable._join_room_ui)
	Player._roomId = ""
	_popPanel[popPanelIndex].panel:GetChild("InputText").text = ""
end

function ClickEvent.CreateRoomButton( ... )
	-- body
	Player.LogWarning("CreateRoom")
	ClickEvent.PopPanel(ClickEvent.panelTable._create_room_ui)
	local costCard = ""
	if _popPanel[popPanelIndex].panel:GetChild("Round4").selected then
		costCard = "1/"
	elseif _popPanel[popPanelIndex].panel:GetChild("Round8").selected then
		costCard = "2/"
	end
	_popPanel[popPanelIndex].panel:GetChild("RoomCardNum").text = costCard..tostring(Player._player_data.common_prop.room_card_count)
	--CS.UnityEngine.Application.LoadLevel("PlaySence")
end

function ClickEvent.Round4( ... )
	-- body
	_popPanel[popPanelIndex].panel:GetChild("RoomCardNum").text = "1/"..tostring(Player._player_data.common_prop.room_card_count)
end

function ClickEvent.Round8( ... )
	-- body
	_popPanel[popPanelIndex].panel:GetChild("RoomCardNum").text = "2/"..tostring(Player._player_data.common_prop.room_card_count)
end

function ClickEvent.FreshHandButton( ... )
	-- body
	Player.CmdEnterRoom("ROOM_TYPE_XINSHOU")
	Player.isFriendRoom = false
	Player.isWaitingList = true
	Player.waitingTimestamp = CS.UnityEngine.Time.time
	_currentPanel.panel:GetTransition("WaitingPopIn"):Play()
end

function ClickEvent.MasterHandButton( ... )
	-- body
	Player.CmdEnterRoom("ROOM_TYPE_GAOSHOU")
	Player.isFriendRoom = false
	Player.isWaitingList = true
	Player.waitingTimestamp = CS.UnityEngine.Time.time
	_currentPanel.panel:GetTransition("WaitingPopIn"):Play()
end

function ClickEvent.GreatNasterHandButton( ... )
	-- body
	Player.CmdEnterRoom("ROOM_TYPE_DASHI")
	Player.isFriendRoom = false
	Player.isWaitingList = true
	Player.waitingTimestamp = CS.UnityEngine.Time.time
	_currentPanel.panel:GetTransition("WaitingPopIn"):Play()
end

function ClickEvent.CloseWaiting( ... )
	-- body
	Player.isWaitingList = false
	_currentPanel.panel:GetTransition("WaitingPopOut"):Play()
end

function ClickEvent.Close( ... )
	-- body
	Player.LogWarning("ClosePanel")
	if popPanelIndex <= 0 then
		return false
	end
	if _popPanel[popPanelIndex].panel.name == ClickEvent.panelTable._setting_ui then
		Player.CmdGameSetting(Player._player_data.game_setting.music, Player._player_data.game_setting.voice, Player._player_data.game_setting.audio, Player._player_data.game_setting.click_push)
	end
	GRoot.inst:RemoveChild(_popPanel[popPanelIndex].panel)
	_popPanel[popPanelIndex].panel = nil
	if _popPanel[popPanelIndex].background then
		GRoot.inst:RemoveChild(_popPanel[popPanelIndex].background)
		_popPanel[popPanelIndex].background = nil
	end
	popBgIndex = popBgIndex - 1
	popPanelIndex = popPanelIndex - 1
	if popPanelIndex < 0 then
		popPanelIndex = 0
	end
	if popBgIndex < 0 then
		popBgIndex = 0
	end
end

function ClickEvent.CreateRoomId( gameObject )
	-- body
	Player._roomId = tonumber(gameObject:GetComponent("InputField").text)
	Player.LogWarning(gameObject.name)
end

function ClickEvent.ClassicMode( ... )
	-- body
	for i=1,7 do
		_popPanel[popPanelIndex].panel:GetChild("ChooseFan0"..tostring(i)).selected = false
	end
	_popPanel[popPanelIndex].panel:GetChild("Multiple8").selected = true
end

function ClickEvent.HighRiskMode( ... )
	-- body
	for i=1,7 do
		_popPanel[popPanelIndex].panel:GetChild("ChooseFan0"..tostring(i)).selected = true
	end
	_popPanel[popPanelIndex].panel:GetChild("MultipleNolimit").selected = true
end

function ClickEvent.CreateButton( )
	-- body
	--roomid
	Player.LogWarning("CreateRoom")
	local model = nil
	local extend_type = {}
	local top_mutiple = nil
	local open_rands = nil
	local costCard = 0
	local cardActivity = false

	if _popPanel[popPanelIndex].panel:GetChild("ClassicMode").selected then
		model = "ROOM_MODEL_TYPE_CLASSICAL"
	elseif _popPanel[popPanelIndex].panel:GetChild("HighRiskMode").selected then
		model = "ROOM_MODEL_TYPE_MULTIPLE"
	end

	if _popPanel[popPanelIndex].panel:GetChild("Multiple8").selected then
		top_mutiple = 8
	elseif _popPanel[popPanelIndex].panel:GetChild("Multiple32").selected then
		top_mutiple = 32
	elseif _popPanel[popPanelIndex].panel:GetChild("MultipleNolimit").selected then
		top_mutiple = 0
	end

	if _popPanel[popPanelIndex].panel:GetChild("Round4").selected then
		costCard = 1
		open_rands = 8
	elseif _popPanel[popPanelIndex].panel:GetChild("Round8").selected then
		costCard = 2
		open_rands = 16
	end

	local extend_type_count = 1
	if _popPanel[popPanelIndex].panel:GetChild("ChooseFan01").selected then
		extend_type[extend_type_count] = "ROOM_EXTEND_TYPE_ZHANLIHU"
		extend_type_count = extend_type_count + 1
	end
	if _popPanel[popPanelIndex].panel:GetChild("ChooseFan02").selected then
		extend_type[extend_type_count] = "ROOM_EXTEND_TYPE_JIAHU"
		extend_type_count = extend_type_count + 1
	end
	if _popPanel[popPanelIndex].panel:GetChild("ChooseFan03").selected then
		extend_type[extend_type_count] = "ROOM_EXTEND_TYPE_XUANFENGGANG"
		extend_type_count = extend_type_count + 1
	end
	if _popPanel[popPanelIndex].panel:GetChild("ChooseFan04").selected then
		extend_type[extend_type_count] = "ROOM_EXTEND_TYPE_BAOPAI"
		extend_type_count = extend_type_count + 1
	end
	if _popPanel[popPanelIndex].panel:GetChild("ChooseFan05").selected then
		extend_type[extend_type_count] = "ROOM_EXTEND_TYPE_DUANMEN"
		extend_type_count = extend_type_count + 1
	end
	if _popPanel[popPanelIndex].panel:GetChild("ChooseFan06").selected then
		extend_type[extend_type_count] = "ROOM_EXTEND_TYPE_QIYISE"
		extend_type_count = extend_type_count + 1
	end
	if _popPanel[popPanelIndex].panel:GetChild("ChooseFan07").selected then
		extend_type[extend_type_count] = "ROOM_EXTEND_TYPE_BAOSANJIA"
		extend_type_count = extend_type_count + 1
	end
	if Player.activityTable then
		for k,v in pairs(Player.activityTable) do
			if v.activity_id == Player.activityDataTable.room_card_limit_free_activity_id then
				if v.open == true then
					cardActivity = true
				end
				break
			end
		end
	end
	ClickEvent.Close()
	if cardActivity == true then
		Player.CmdCreateRoom(model,extend_type,top_mutiple,open_rands)
		Player.isFriendRoom = true
	else
		if Player._player_data.common_prop.room_card_count >= costCard then
			Player.CmdCreateRoom(model,extend_type,top_mutiple,open_rands)
			Player.isFriendRoom = true
		else
			ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
			_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(2032)
		end
	end
	--[[
	Player.CmdCreateRoom(model,extend_type,top_mutiple,open_rands)
	Player.isFriendRoom = true
	--]]
end

function ClickEvent.JoinRoomId( gameObject )
	-- body
	Player._roomId = tonumber(gameObject:GetComponent("InputField").text)
end

function ClickEvent.GetinButton( ... )
	-- body
	Player._roomId = tonumber(_popPanel[popPanelIndex].panel:GetChild("InputText").text)
	Player.LogWarning(tonumber(Player._roomId))
	Player.CmdEnterRoom("ROOM_TYPE_FRIEND",Player._roomId)
	Player.isFriendRoom = true
	ClickEvent.Close()
end
--数字
function ClickEvent.KeyBoardNumber(number)
	-- body
	if Player._roomId then
		_popPanel[popPanelIndex].panel:GetChild("InputText").text = tostring(Player._roomId)
		_popPanel[popPanelIndex].panel:GetChild("InputText").text = _popPanel[popPanelIndex].panel:GetChild("InputText").text..tostring(number)
	else
		_popPanel[popPanelIndex].panel:GetChild("InputText").text = tostring(number)
	end
	Player._roomId = tonumber(_popPanel[popPanelIndex].panel:GetChild("InputText").text)
end

function ClickEvent.KeyBoardZero( ... )
	-- body
	ClickEvent.KeyBoardNumber(0)
end
function ClickEvent.KeyBoardOne( ... )
	-- body
	ClickEvent.KeyBoardNumber(1)
end
function ClickEvent.KeyBoardTwo( ... )
	-- body
	ClickEvent.KeyBoardNumber(2)
end
function ClickEvent.KeyBoardThree( ... )
	-- body
	ClickEvent.KeyBoardNumber(3)
end
function ClickEvent.KeyBoardFour( ... )
	-- body
	ClickEvent.KeyBoardNumber(4)
end
function ClickEvent.KeyBoardFive( ... )
	-- body
	ClickEvent.KeyBoardNumber(5)
end
function ClickEvent.KeyBoardSix( ... )
	-- body
	ClickEvent.KeyBoardNumber(6)
end
function ClickEvent.KeyBoardSeven( ... )
	-- body
	ClickEvent.KeyBoardNumber(7)
end
function ClickEvent.KeyBoardEight( ... )
	-- body
	ClickEvent.KeyBoardNumber(8)
end
function ClickEvent.KeyBoardNine( ... )
	-- body
	ClickEvent.KeyBoardNumber(9)
end

function ClickEvent.Clear( ... )
 	-- body
 	_popPanel[popPanelIndex].panel:GetChild("InputText").text = ""
 	Player._roomId = nil
end
function ClickEvent.BackSpaceButton( ... )
	-- body
	local tempStr = _popPanel[popPanelIndex].panel:GetChild("InputText").text
	if tempStr then
		_popPanel[popPanelIndex].panel:GetChild("InputText").text = string.sub(tempStr,1,-2)
		Player._roomId = tonumber(_popPanel[popPanelIndex].panel:GetChild("InputText").text)
	end
end
--[[
--]]

-------------------------------------
---游戏中
---------------------------

function ClickEvent.GameBillButton(gameObject)
	-- body
	ClickEvent.PopPanel(ClickEvent.panelTable._history_score_ui)
	if Player._room_information.options.model == "ROOM_MODEL_TYPE_CLASSICAL" then
		_popPanel[popPanelIndex].panel:GetChild("ModeText").text = "经典模式"
	else
		_popPanel[popPanelIndex].panel:GetChild("ModeText").text = "高番模式"
	end
	local fanxing = ""
	for k,v in pairs(Player._room_information.options.extend_type) do
		if v == "ROOM_EXTEND_TYPE_ZHANLIHU" then
			fanxing = fanxing.."站立胡"
		elseif v == "ROOM_EXTEND_TYPE_JIAHU" then
			fanxing = fanxing.."带夹胡"
		elseif v == "ROOM_EXTEND_TYPE_XUANFENGGANG" then
			fanxing = fanxing.."旋风杠"
		elseif v == "ROOM_EXTEND_TYPE_BAOPAI" then
			fanxing = fanxing.."宝牌"
		elseif v == "ROOM_EXTEND_TYPE_DUANMEN" then
			fanxing = fanxing.."可断门"
		elseif v == "ROOM_EXTEND_TYPE_QIYISE" then
			fanxing = fanxing.."清一色"
		elseif v == "ROOM_EXTEND_TYPE_BAOSANJIA" then
			fanxing = fanxing.."点炮包三家"
		end
		fanxing = fanxing.."、"
	end
	fanxing = string.sub(fanxing, 1, -2)
	_popPanel[popPanelIndex].panel:GetChild("FanText").text = fanxing
	_popPanel[popPanelIndex].panel:GetChild("RoundText").text = tostring(Player._room_information.options.open_rands).."局"
	if Player._room_information.options.top_mutiple == 0 then
		_popPanel[popPanelIndex].panel:GetChild("MultipleText").text = "不封顶"
	else
		_popPanel[popPanelIndex].panel:GetChild("MultipleText").text = tostring(Player._room_information.options.top_mutiple).."倍"
	end
	local roundCount = 0
	local historyList = _popPanel[popPanelIndex].panel:GetChild("HistoryList")
	historyList:RemoveChildrenToPool()
	local countScore = {}
	for i=1,4 do
		countScore[i] = {}
		countScore[i].nickname = ""
		countScore[i].headimgurl = ""
		countScore[i].allScore = 0
	end
	WeChatPlatform.func = nil
	if Player._all_calculate_data then
		for c=1,Player._calculate_table_number do
			local obj = historyList:AddItemFromPool(UIPackage.GetItemURL("MXUI","VipNoteListInRound"))
			obj.name = "VipNoteListInRound"
			roundCount = roundCount + 1
			obj:GetChild("RoundNum").text = tostring(roundCount)
			local playerNumber = 1
			for roundKey,roundData in pairs(Player._all_calculate_data[c].list) do
				countScore[playerNumber].nickname = tostring(gbk.toutf8(gbk.fromutf8(roundData.nickname)))
				countScore[playerNumber].headimgurl = roundData.headimgurl
				countScore[playerNumber].allScore = countScore[playerNumber].allScore + roundData.score
				obj:GetChild("VipNoteListRountUnit"..tostring(playerNumber)):GetChild("PlayerName").text = tostring(gbk.toutf8(gbk.fromutf8(roundData.nickname)))
				obj:GetChild("VipNoteListRountUnit"..tostring(playerNumber)):GetChild("WinLoseNum").text = tostring(roundData.score)
				obj:GetChild("VipNoteListRountUnit"..tostring(playerNumber)):GetChild("AvatarLoader").url = UIPackage.GetItemURL("MXUI","Touxiang01")
				if roundData.headimgurl and roundData.headimgurl ~= "" then
					obj:GetChild("VipNoteListRountUnit"..tostring(playerNumber)):GetChild("AvatarLoader").url = ""
					local tempTexture = WeChatPlatform:SetAsyncImage(roundData.headimgurl)
					if tempTexture then
						obj:GetChild("VipNoteListRountUnit"..tostring(playerNumber)):GetChild("AvatarLoader").texture = NTexture(tempTexture)
					end
				end
				playerNumber = playerNumber + 1
			end
		end
	end
	local historyShareList = _popPanel[popPanelIndex].panel:GetChild("HistoryShareList")
	historyShareList:RemoveChildrenToPool()
	for i=1,4 do
		local tempTable = {}
		for j=i,4 do
			if countScore[i].allScore < countScore[j].allScore then
				tempTable = countScore[i]
				countScore[i] = countScore[j]
				countScore[j] = tempTable
			end
		end
	end
	for i=1,4 do
		local obj = historyShareList:AddItemFromPool(UIPackage.GetItemURL("MXUI","VipNoteListInTotal"))
		obj.name = "VipNoteListInTotal"
		obj:GetChild("Rank").text = tostring(i)
		if countScore[i].allScore < 0 then
			local loseFont = obj:GetChild("VipNoteListTotalUnit"):GetChild("WinLoseNum").textFormat
			loseFont.font = UIPackage.GetItemURL("MXUI","LoseFont")
			obj:GetChild("VipNoteListTotalUnit"):GetChild("WinLoseNum").textFormat = loseFont
			obj:GetChild("VipNoteListTotalUnit"):GetChild("WinLoseNum").text = tostring(countScore[i].allScore)
		else
			local winFont = obj:GetChild("VipNoteListTotalUnit"):GetChild("WinLoseNum").textFormat
			winFont.font = UIPackage.GetItemURL("MXUI","WinFont")
			obj:GetChild("VipNoteListTotalUnit"):GetChild("WinLoseNum").textFormat = winFont
			obj:GetChild("VipNoteListTotalUnit"):GetChild("WinLoseNum").text = tostring(countScore[i].allScore)
		end
		obj:GetChild("VipNoteListTotalUnit"):GetChild("PlayerName").text = tostring(countScore[i].nickname)
		obj:GetChild("VipNoteListTotalUnit"):GetChild("AvatarLoader").url  = UIPackage.GetItemURL("MXUI","Touxiang01")
		if countScore[i].headimgurl and countScore[i].headimgurl ~= "" then
			obj:GetChild("VipNoteListTotalUnit"):GetChild("AvatarLoader").url = ""
			local tempTexture = WeChatPlatform:SetAsyncImage(countScore[i].headimgurl)
			if tempTexture then
				obj:GetChild("VipNoteListTotalUnit"):GetChild("AvatarLoader").texture = NTexture(tempTexture)
			end
		end
		obj:GetChild("VipNoteListTotalUnit"):GetChild("TotalRoundNum").text = tostring(roundCount)
	end
end

function ClickEvent.GameListenButton(gameObject)
	-- body
	if _currentPanel.panel:GetChild("GameListenButton").selected then
		WeChatPlatform.m_voiceengine:CloseSpeaker()
	else
		WeChatPlatform.m_voiceengine:OpenSpeaker()
	end
end

function ClickEvent.GameVoiceButton(gameObject)
	-- body
	if _currentPanel.panel:GetChild("GameVoiceButton").selected then
		WeChatPlatform.m_voiceengine:CloseMic()
	else
		WeChatPlatform.m_voiceengine:OpenMic()
	end
end

function ClickEvent.GameBackButton(gameObject)
	-- body
	if ClickEvent.IsPopPanel(ClickEvent.panelTable._share_calculate_ui) == true then
		ClickEvent.Close()
	else
		ClickEvent.PopPanel(ClickEvent.panelTable._window_small)
		_popPanel[popPanelIndex].panel:GetChild("PopWindowsSmallShowText").text = StringTable.Get(2003)
	end
end

function ClickEvent.GameTingButton(gameObject)
	-- body
	--ClickEvent.CloseOperationPanel()
	ClickEvent._play_ui.operationBar:RemoveChildrenToPool()
	Player.MahJong.TingPaiUpdateState()
	Player.MahJong.SetCurrentState(operationState.DAPAI)
	--Player.CmdPaiOperation("PAI_OPER_TYPE_TINGPAI",{},{})
end

function ClickEvent.GamePlayButton( gameObject )
	-- body
	gameObject.visible = false
	--Player.MahJong.PlayDoubleDices()
	Player.CmdGameOperation("GAME_OPER_TYPE_START")
end

function ClickEvent.GameGangButton(gameObject)
	-- body
	ClickEvent.CloseOperationPanel()
	local angangCount = 0
	local tempPai = nil
	if Player._operation_alert_cache.pais then
		for k,v in pairs(Player._operation_alert_cache.pais) do
			for j,m in pairs(v.oper_list) do
				if m == "PAI_OPER_TYPE_ANGANGPAI" then
					angangCount = angangCount + 1
				end
			end
		end
	end
	if angangCount > 1 then
		if Player._operation_alert_cache.pais then
			for k,v in pairs(Player._operation_alert_cache.pais) do
				for j,m in pairs(v.oper_list) do
					if m == "PAI_OPER_TYPE_ANGANGPAI" then
						Player.MahJong.CreateGangPai(v.pai)
					end
				end
			end
		end
	else
		Player.MahJong.GangPai()
	end
end

function ClickEvent.XuanFengButton(gameObject)
	-- body
	ClickEvent.CloseOperationPanel()
	Player.MahJong.XuanFengGang()
end

function ClickEvent.GameChiButton(gameObject)
	-- body
	ClickEvent.CloseOperationPanel()
	Player.MahJong.CheckChiPai()
	--Player.MahJong.ChiPai()
end

function ClickEvent.CreateChiPai(cardType,paiGroup,paiValue1,paiValue2,paiValue3)--牌类型、牌组数、牌值、
	-- body
	ClickEvent._play_ui.chiPaiBar.visible = true
	ClickEvent._play_ui.passButton.visible = true
	local chiPaiGroupTemp = ClickEvent._play_ui.chiPaiBar:GetChild("ChiPaiList"):AddItemFromPool(UIPackage.GetItemURL("MXUI","ChiPai"))
	chiPaiGroupTemp.name = tostring(paiGroup)
	chiPaiGroupTemp:GetChild("ChiPaiLoader01").url = UIPackage.GetItemURL("MXUI",cardType.."_"..paiValue1)
	chiPaiGroupTemp:GetChild("ChiPaiLoader02").url = UIPackage.GetItemURL("MXUI",cardType.."_"..paiValue2)
	chiPaiGroupTemp:GetChild("ChiPaiLoader03").url = UIPackage.GetItemURL("MXUI",cardType.."_"..paiValue3)
	chiPaiGroupTemp.onClick:Add(Player.MahJong.ClickChiPaiEvent)
	ClickEvent._play_ui.chiPaiBar:GetChild("ChiPaiList").width = chiPaiGroupTemp.width * paiGroup
end

function ClickEvent.CreateGangPai(cardType,paiValue,paiGroup)
	-- body
	ClickEvent._play_ui.gangPaiBar.visible = true
	ClickEvent._play_ui.passButton.visible = true
	if cardType == "CARD_TYPE_JIAN" then
		local gangPaiGroupTemp = ClickEvent._play_ui.gangPaiBar:GetChild("ChiPaiList"):AddItemFromPool(UIPackage.GetItemURL("MXUI","ChiPai"))
		gangPaiGroupTemp.name = tostring(paiGroup)
		gangPaiGroupTemp:GetChild("ChiPaiLoader01").url = UIPackage.GetItemURL("MXUI",cardType.."_"..1)
		gangPaiGroupTemp:GetChild("ChiPaiLoader02").url = UIPackage.GetItemURL("MXUI",cardType.."_"..2)
		gangPaiGroupTemp:GetChild("ChiPaiLoader03").url = UIPackage.GetItemURL("MXUI",cardType.."_"..3)
		gangPaiGroupTemp.onClick:Add(Player.MahJong.ClickGangPaiEvent)
	elseif cardType == "CARD_TYPE_FENG" then
		local gangPaiGroupTemp = ClickEvent._play_ui.gangPaiBar:GetChild("ChiPaiList"):AddItemFromPool(UIPackage.GetItemURL("MXUI","GangPai"))
		gangPaiGroupTemp.name = tostring(paiGroup)
		gangPaiGroupTemp:GetChild("ChiPaiLoader01").url = UIPackage.GetItemURL("MXUI",cardType.."_"..1)
		gangPaiGroupTemp:GetChild("ChiPaiLoader02").url = UIPackage.GetItemURL("MXUI",cardType.."_"..2)
		gangPaiGroupTemp:GetChild("ChiPaiLoader03").url = UIPackage.GetItemURL("MXUI",cardType.."_"..3)
		gangPaiGroupTemp:GetChild("ChiPaiLoader04").url = UIPackage.GetItemURL("MXUI",cardType.."_"..4)
		gangPaiGroupTemp.onClick:Add(Player.MahJong.ClickGangPaiEvent)
	else
		local gangPaiGroupTemp = ClickEvent._play_ui.gangPaiBar:GetChild("ChiPaiList"):AddItemFromPool(UIPackage.GetItemURL("MXUI","GangPai"))
		gangPaiGroupTemp.name = tostring(paiGroup)
		gangPaiGroupTemp:GetChild("ChiPaiLoader01").url = UIPackage.GetItemURL("MXUI",cardType.."_"..paiValue)
		gangPaiGroupTemp:GetChild("ChiPaiLoader02").url = UIPackage.GetItemURL("MXUI",cardType.."_"..paiValue)
		gangPaiGroupTemp:GetChild("ChiPaiLoader03").url = UIPackage.GetItemURL("MXUI",cardType.."_"..paiValue)
		gangPaiGroupTemp:GetChild("ChiPaiLoader04").url = UIPackage.GetItemURL("MXUI",cardType.."_"..paiValue)
		gangPaiGroupTemp.onClick:Add(Player.MahJong.ClickGangPaiEvent)
	end
	ClickEvent._play_ui.gangPaiBar:GetChild("ChiPaiList").width = gangPaiGroupTemp.width * paiGroup
end

function ClickEvent.CloseChiPai()
	-- body
	ClickEvent._play_ui.chiPaiBar:GetChild("ChiPaiList"):RemoveChildrenToPool()
	ClickEvent._play_ui.chiPaiBar.visible = false
end

function ClickEvent.CloseGangPai()
	-- body
	ClickEvent._play_ui.gangPaiBar:GetChild("ChiPaiList"):RemoveChildrenToPool()
	ClickEvent._play_ui.gangPaiBar.visible = false
end

function ClickEvent.GamePengButton(gameObject)
	-- body
	ClickEvent.CloseOperationPanel()
	Player.MahJong.PengPai()
end

function ClickEvent.GameHuButton(gameObject)
	-- body
	ClickEvent.CloseOperationPanel()
    Player.MahJong.HuPai()
end

function ClickEvent.GamePassButton(gameObject)
	-- body
	ClickEvent.CloseOperationPanel()
	ClickEvent.CloseChiPai()
	ClickEvent.CloseGangPai()
	Player.MahJong.GuoPai()
	Effect.DeleteEffect(Effect._effect_name.maybeOperationShowCircle)
end

function ClickEvent.GameCancelButton(gameObject)
	-- body
	Player._ting_pai_cache = nil
	ClickEvent.CloseOperationPanel()
	Player.MahJong.SetCurrentState(operationState.DAPAI)
	Player.MahJong.TingPaiCancelState()
end

function ClickEvent.CloseOperationPanel()
	-- body
	ClickEvent._play_ui.operationBar:RemoveChildrenToPool()
	ClickEvent._play_ui.passButton.visible = false
	ClickEvent._play_ui.cancelButton.visible = false
end

---------------------------------------------------------------------------
---------------------------------------------------------------------------
function ClickEvent.registerButtonClick(gameObject)
	-- body
	local key = gameObject.sender.name
	--[[
	switch = {
		
		["Reward"] = function ( ... )
			-- body
		end,
		["More"] = function ( ... )
			-- body
		end,
		["ClosePlayerMessagePanel"] = function ( ... )
			-- body
			_Player_Message_UI:SetActive(false)
		end,
	}
	--]]
	local fSwitch = ClickEvent[key]

	if fSwitch then
		local result = fSwitch(gameObject.sender)
		if key == "Close" then
			AudioPlayer.PlaySound(AudioPlayer._audio_name.CloseUI,false,1)
		else
			AudioPlayer.PlaySound(AudioPlayer._audio_name.ClickUI,false,1)
		end
	else
		if gameObject.sender.gameObjectName == "HelloEmojiListButton" then
			ClickEvent.Emoji(gameObject.sender)
		end
		if gameObject.sender.gameObjectName == "HelloTextListButton" then
			ClickEvent.HelloText(gameObject.sender)
		end
		Player.LogWarning(key)
		Player.LogWarning("key no found")
	end

end

function ClickEvent.registerButtonDown(gameObject)
	-- body
	_popPanel[popPanelIndex].background:GetChild("Di").visible  = false
	if _popPanel[popPanelIndex].panel.name == ClickEvent.panelTable._calculate_ui then
		_popPanel[popPanelIndex].panel.visible = false
	end
	
end

function ClickEvent.registerButtonUp(gameObject)
	-- body
	_popPanel[popPanelIndex].background:GetChild("Di").visible  = true
	if _popPanel[popPanelIndex].panel.name == ClickEvent.panelTable._calculate_ui then
		_popPanel[popPanelIndex].panel.visible = true
	end
end

return ClickEvent